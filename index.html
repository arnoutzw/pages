<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maker Portfolio | GitHub Projects</title>
  <meta name="description" content="A portfolio of maker and tinkerer projects, powered by GitHub">

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”§</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwindcss.config = {
      theme: {
        extend: {
          fontFamily: {
            mono: ['JetBrains Mono', 'monospace'],
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- Markdown Parser & Syntax Highlighting -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">

  <style>
    * { font-family: 'Inter', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace !important; }

    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #18181b; }
    ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #52525b; }

    /* Line clamp */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Animation */
    @keyframes spin { to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }

    /* Markdown Prose Styles */
    .markdown-body { color: #a1a1aa; line-height: 1.7; }
    .markdown-body h1 { font-size: 1.875rem; font-weight: 700; color: #f59e0b; margin-top: 1.5rem; margin-bottom: 1rem; font-family: 'JetBrains Mono', monospace; border-bottom: 1px solid #3f3f46; padding-bottom: 0.5rem; }
    .markdown-body h2 { font-size: 1.5rem; font-weight: 600; color: #fbbf24; margin-top: 1.5rem; margin-bottom: 0.75rem; font-family: 'JetBrains Mono', monospace; border-bottom: 1px solid #3f3f46; padding-bottom: 0.5rem; }
    .markdown-body h3 { font-size: 1.25rem; font-weight: 600; color: #fcd34d; margin-top: 1.25rem; margin-bottom: 0.5rem; font-family: 'JetBrains Mono', monospace; }
    .markdown-body h4 { font-size: 1.125rem; font-weight: 600; color: #fde68a; margin-top: 1rem; margin-bottom: 0.5rem; font-family: 'JetBrains Mono', monospace; }
    .markdown-body p { margin-bottom: 1rem; }
    .markdown-body a { color: #f59e0b; text-decoration: underline; transition: color 0.2s; }
    .markdown-body a:hover { color: #fbbf24; }
    .markdown-body strong { color: #e4e4e7; font-weight: 600; }
    .markdown-body em { font-style: italic; }
    .markdown-body code:not(pre code) { background: #27272a; color: #4ade80; padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; }
    .markdown-body pre { background: #18181b; border: 1px solid #3f3f46; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
    .markdown-body pre code { background: transparent; padding: 0; font-size: 0.875rem; line-height: 1.5; }
    .markdown-body ul, .markdown-body ol { margin: 1rem 0; padding-left: 1.5rem; }
    .markdown-body ul { list-style-type: disc; }
    .markdown-body ol { list-style-type: decimal; }
    .markdown-body li { margin-bottom: 0.5rem; color: #d4d4d8; }
    .markdown-body li::marker { color: #f59e0b; }
    .markdown-body blockquote { border-left: 3px solid #f59e0b; padding-left: 1rem; margin: 1rem 0; color: #a1a1aa; font-style: italic; background: #27272a40; padding: 0.75rem 1rem; border-radius: 0 0.5rem 0.5rem 0; }
    .markdown-body img { max-width: 100%; border-radius: 0.5rem; margin: 1rem 0; border: 1px solid #3f3f46; }
    .markdown-body hr { border: none; border-top: 1px solid #3f3f46; margin: 2rem 0; }
    .markdown-body table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    .markdown-body th, .markdown-body td { border: 1px solid #3f3f46; padding: 0.75rem; text-align: left; }
    .markdown-body th { background: #27272a; color: #fbbf24; font-family: 'JetBrains Mono', monospace; font-weight: 600; }
    .markdown-body td { background: #18181b; }
    .markdown-body tr:hover td { background: #1f1f23; }
    .markdown-body input[type="checkbox"] { margin-right: 0.5rem; accent-color: #f59e0b; }
    .markdown-body .task-list-item { list-style-type: none; margin-left: -1.25rem; }

    /* Code block header */
    .code-block-wrapper { position: relative; margin: 1rem 0; }
    .code-block-header { background: #27272a; border: 1px solid #3f3f46; border-bottom: none; border-radius: 0.5rem 0.5rem 0 0; padding: 0.5rem 1rem; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #71717a; display: flex; justify-content: space-between; align-items: center; }
    .code-block-header + pre { margin-top: 0; border-radius: 0 0 0.5rem 0.5rem; }
    .copy-btn { background: #3f3f46; border: none; color: #a1a1aa; padding: 0.25rem 0.5rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem; transition: all 0.2s; }
    .copy-btn:hover { background: #52525b; color: #e4e4e7; }

    /* Inline emoji */
    .inline-emoji { display: inline; height: 1.2em; width: 1.2em; vertical-align: text-bottom; margin: 0 0.05em; }
  </style>
</head>
<body class="bg-zinc-950">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ============================================
    // CONFIGURATION - CHANGE THESE VALUES
    // ============================================
    const CONFIG = {
      // Your GitHub username
      GITHUB_USERNAME: 'arnoutzw',

      // Maximum number of repos to fetch
      MAX_REPOS: 100,

      // Site title
      SITE_TITLE: 'Maker Portfolio',

      // Tagline shown in header
      TAGLINE: 'Building things that work (mostly)',

      // Repos to exclude (by name)
      EXCLUDE_REPOS: ['lab-inventory', 'label-designer', 'resistor-colorcode-gen', 'datasheet-search', 'model-library', 'rlc-calculator', 'biquad-pwa', 'pages'], // Exclude embedded apps and the pages repo itself

      // Only show repos with these topics (leave empty to show all)
      FILTER_TOPICS: [],

      // Hide forked repos
      HIDE_FORKS: false,

      // Admin password for login (enables hide/unhide repos)
      ADMIN_PASSWORD: 'admin',

      // Integrated apps (local copies, linked from portfolio)
      INTEGRATED_APPS: [
        {
          id: 'lab-inventory',
          name: 'Lab Inventory',
          icon: 'Package',
          url: './lab-inventory-app/index.html',
          description: 'Electronics component manager',
          isLocal: true,
          fullscreen: true,
          requiresAdmin: true
        },
        {
          id: 'label-designer',
          name: 'Label Designer',
          icon: 'PenTool',
          url: './label-designer/index.html',
          description: 'Design and print custom labels',
          isLocal: true,
          fullscreen: true
        },
        {
          id: 'ray-optics',
          name: 'Ray Optics',
          icon: 'Sun',
          url: 'https://phydemo.app/ray-optics/simulator/',
          description: 'Interactive ray optics simulator',
          isLocal: false,
          fullscreen: true
        },
        {
          id: 'circuit-sim',
          name: 'Circuit Sim',
          icon: 'Zap',
          url: 'https://www.falstad.com/circuit/circuitjs.html',
          description: 'Interactive circuit simulator',
          isLocal: false,
          fullscreen: true
        },
        {
          id: 'resistor-colorcode',
          name: 'Resistor Colors',
          icon: 'Cpu',
          url: './resistor-colorcode-gen/index.html',
          description: '4-band resistor color code generator',
          isLocal: true,
          fullscreen: true
        },
        {
          id: 'datasheet-search',
          name: 'Datasheets',
          icon: 'FileSearch',
          url: './datasheet-search/index.html',
          description: 'Search component datasheets',
          isLocal: true,
          fullscreen: true
        },
        {
          id: 'model-library',
          name: '3D Models',
          icon: 'Box',
          url: './model-library/index.html',
          description: 'STL/3MF model library and viewer',
          isLocal: true,
          fullscreen: true
        },
        {
          id: 'rlc-calculator',
          name: 'Analog Filter Designer',
          icon: 'Activity',
          url: './rlc-calculator/rlc-calculator.html',
          description: 'Continuous-time analog filter design and RLC analysis',
          isLocal: true,
          fullscreen: true
        },
        {
          id: 'biquad-pwa',
          name: 'Digital Filter Designer',
          icon: 'AudioLines',
          url: './biquad-pwa/index.html',
          description: 'Digital biquad IIR filter designer',
          isLocal: true,
          fullscreen: true
        }
      ],
    };
    // ============================================

    // ============================================
    // BUILD INFO - AUTO-UPDATED BY PRE-COMMIT HOOK
    // ============================================
    const BUILD_COMMIT = '18c665ca7b560b8b10dc5bcf983b59e32c3a538e';
    const BUILD_DATE = '2026-02-06';
    // ============================================

    // Lucide icons
    const icons = lucide;

    // Icon component helper
    const Icon = ({ name, size = 20, className = '' }) => {
      const ref = React.useRef(null);
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = icons.createElement(icons[name]);
          icon.setAttribute('width', size);
          icon.setAttribute('height', size);
          if (className) icon.setAttribute('class', className);
          ref.current.appendChild(icon);
        }
      }, [name, size, className]);
      return <span ref={ref} className="inline-flex" />;
    };

    // Language colors
    const languageColors = {
      JavaScript: '#f7df1e', TypeScript: '#3178c6', Python: '#3572A5',
      Rust: '#dea584', Go: '#00ADD8', C: '#555555', 'C++': '#f34b7d',
      Java: '#b07219', Ruby: '#701516', PHP: '#4F5D95', Swift: '#ffac45',
      Kotlin: '#A97BFF', HTML: '#e34c26', CSS: '#563d7c', Shell: '#89e051',
      Dockerfile: '#384d54', Vue: '#41b883', Svelte: '#ff3e00',
    };

    // Time ago helper
    const getTimeAgo = (date) => {
      const seconds = Math.floor((new Date() - new Date(date)) / 1000);
      const intervals = [
        { label: 'year', seconds: 31536000 },
        { label: 'month', seconds: 2592000 },
        { label: 'week', seconds: 604800 },
        { label: 'day', seconds: 86400 },
        { label: 'hour', seconds: 3600 },
      ];
      for (const interval of intervals) {
        const count = Math.floor(seconds / interval.seconds);
        if (count >= 1) return `${count} ${interval.label}${count > 1 ? 's' : ''} ago`;
      }
      return 'just now';
    };

    // Configure marked.js with highlight.js
    const configureMarked = () => {
      // Custom renderer for styled output
      const renderer = new marked.Renderer();

      // Add language label and copy button to code blocks
      // Supports both old marked API (positional args) and new marked v12+ API (token object)
      renderer.code = (codeOrToken, language) => {
        const code = typeof codeOrToken === 'object' ? (codeOrToken.text || '') : codeOrToken;
        const lang = typeof codeOrToken === 'object' ? codeOrToken.lang : language;
        const validLang = lang && hljs.getLanguage(lang) ? lang : 'plaintext';
        const highlighted = hljs.highlight(code, { language: validLang, ignoreIllegals: true }).value;
        const langLabel = lang || 'code';
        const escapedCode = code.replace(/'/g, "\\'").replace(/\n/g, '\\n');
        return `
          <div class="code-block-wrapper">
            <div class="code-block-header">
              <span>${langLabel}</span>
              <button class="copy-btn" onclick="navigator.clipboard.writeText('${escapedCode}').then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 2000); })">Copy</button>
            </div>
            <pre><code class="hljs language-${validLang}">${highlighted}</code></pre>
          </div>
        `;
      };

      // Make links open in new tab
      renderer.link = (hrefOrToken, title, text) => {
        const h = typeof hrefOrToken === 'object' ? (hrefOrToken.href || '') : hrefOrToken;
        const t = typeof hrefOrToken === 'object' ? hrefOrToken.title : title;
        const txt = typeof hrefOrToken === 'object' ? hrefOrToken.text : text;
        const titleAttr = t ? ` title="${t}"` : '';
        return `<a href="${h}"${titleAttr} target="_blank" rel="noopener noreferrer">${txt}</a>`;
      };

      // Handle checkboxes in task lists
      renderer.listitem = (textOrToken, task, checked) => {
        const txt = typeof textOrToken === 'object' ? textOrToken.text : textOrToken;
        const isTask = typeof textOrToken === 'object' ? textOrToken.task : task;
        const isChecked = typeof textOrToken === 'object' ? textOrToken.checked : checked;
        if (isTask) {
          return `<li class="task-list-item"><input type="checkbox" ${isChecked ? 'checked' : ''} disabled> ${txt}</li>`;
        }
        return `<li>${txt}</li>`;
      };

      marked.setOptions({
        renderer,
        gfm: true,
        breaks: true,
        headerIds: true,
        mangle: false,
      });
    };

    // Initialize marked configuration
    configureMarked();

    // GitHub emoji support
    let emojiMap = {};
    fetch('https://api.github.com/emojis')
      .then(r => r.ok ? r.json() : {})
      .then(data => { emojiMap = data; })
      .catch(() => {});

    const replaceEmojis = (text) =>
      text.replace(/:([a-z0-9_+\-]+):/g, (match, name) => {
        const url = emojiMap[name];
        if (!url) return match;
        return `<img src="${url}" alt="${name}" class="inline-emoji" />`;
      });

    // Markdown renderer using marked.js
    const renderMarkdown = (text) => {
      if (!text) return '';
      try {
        const html = marked.parse(text);
        return replaceEmojis(html);
      } catch (e) {
        console.error('Markdown parsing error:', e);
        return `<pre>${text}</pre>`;
      }
    };

    // Project Card
    const ProjectCard = ({ repo, onClick, isAdmin, isHidden, onToggleHide }) => {
      const langColor = languageColors[repo.language] || '#6b7280';

      return (
        <div onClick={onClick}
             className={`group relative bg-zinc-900 border rounded-lg p-5 cursor-pointer
                        hover:border-amber-500/50 hover:bg-zinc-800/80 transition-all duration-300
                        hover:shadow-lg hover:shadow-amber-500/10 hover:-translate-y-1
                        ${isHidden ? 'border-red-500/30 opacity-60' : 'border-zinc-700'}`}>
          {/* Terminal header */}
          <div className="flex items-center gap-2 mb-3 pb-2 border-b border-zinc-700">
            <div className="flex gap-1.5">
              <div className="w-3 h-3 rounded-full bg-red-500/80"></div>
              <div className="w-3 h-3 rounded-full bg-yellow-500/80"></div>
              <div className="w-3 h-3 rounded-full bg-green-500/80"></div>
            </div>
            <span className="text-zinc-500 font-mono text-xs ml-2 truncate flex-1">~/projects/{repo.name}</span>
            {isAdmin && (
              <button onClick={(e) => { e.stopPropagation(); onToggleHide(repo.name); }}
                      title={isHidden ? 'Unhide repo' : 'Hide repo'}
                      className={`p-1 rounded transition-colors z-10 ${isHidden
                        ? 'text-red-400 hover:bg-red-500/20 hover:text-red-300'
                        : 'text-zinc-600 hover:bg-zinc-700 hover:text-zinc-300'}`}>
                <Icon name={isHidden ? 'EyeOff' : 'Eye'} size={14} />
              </button>
            )}
          </div>

          <div className="flex items-center gap-2 mb-2">
            <h3 className="text-xl font-mono font-bold text-zinc-100 group-hover:text-amber-400 transition-colors truncate">
              {repo.name}
            </h3>
            {isHidden && (
              <span className="text-xs bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded font-mono shrink-0">hidden</span>
            )}
          </div>

          <p className="text-zinc-400 text-sm mb-4 line-clamp-2 min-h-[40px]">
            {repo.description || 'No description provided'}
          </p>

          {/* Topics */}
          {repo.topics && repo.topics.length > 0 && (
            <div className="flex flex-wrap gap-1.5 mb-3">
              {repo.topics.slice(0, 3).map(topic => (
                <span key={topic} className="text-xs px-2 py-0.5 bg-amber-500/10 text-amber-400 rounded font-mono">
                  {topic}
                </span>
              ))}
              {repo.topics.length > 3 && (
                <span className="text-xs text-zinc-500">+{repo.topics.length - 3}</span>
              )}
            </div>
          )}

          {/* Stats */}
          <div className="flex items-center gap-4 text-xs text-zinc-500">
            {repo.language && (
              <div className="flex items-center gap-1.5">
                <span className="w-3 h-3 rounded-full" style={{ backgroundColor: langColor }}></span>
                <span>{repo.language}</span>
              </div>
            )}
            <div className="flex items-center gap-1">
              <Icon name="Star" size={14} className="text-amber-500" />
              <span>{repo.stargazers_count}</span>
            </div>
            <div className="flex items-center gap-1">
              <Icon name="GitFork" size={14} />
              <span>{repo.forks_count}</span>
            </div>
          </div>

          <div className="flex items-center gap-1 text-xs text-zinc-600 mt-3">
            <Icon name="Clock" size={12} />
            <span>Updated {getTimeAgo(repo.updated_at)}</span>
          </div>

          <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-amber-500 to-orange-500
                          scale-x-0 group-hover:scale-x-100 transition-transform duration-300 rounded-b-lg"></div>
        </div>
      );
    };

    // Documentation Reader Modal
    const ProjectModal = ({ repo, username, onClose }) => {
      const [docs, setDocs] = useState([]);
      const [selectedDoc, setSelectedDoc] = useState(null);
      const [content, setContent] = useState('');
      const [loading, setLoading] = useState(true);
      const [docsLoading, setDocsLoading] = useState(true);
      const [sidebarOpen, setSidebarOpen] = useState(true);
      const [expandedFolders, setExpandedFolders] = useState({});
      const [viewMode, setViewMode] = useState('docs'); // 'docs' or 'code'
      const [codeFiles, setCodeFiles] = useState([]);
      const [codeLoading, setCodeLoading] = useState(false);
      const [selectedCodeFile, setSelectedCodeFile] = useState(null);
      const [codeContent, setCodeContent] = useState('');
      const [codeContentLoading, setCodeContentLoading] = useState(false);

      const toggleFolder = (folderPath) => {
        setExpandedFolders(prev => ({ ...prev, [folderPath]: !prev[folderPath] }));
      };

      // Build a nested tree from flat file paths
      const buildTree = (paths) => {
        const root = { name: '', children: {}, files: [] };
        paths.forEach(path => {
          const parts = path.split('/');
          let current = root;
          for (let i = 0; i < parts.length - 1; i++) {
            const folderName = parts[i];
            if (!current.children[folderName]) {
              current.children[folderName] = { name: folderName, children: {}, files: [] };
            }
            current = current.children[folderName];
          }
          current.files.push({ name: parts[parts.length - 1], path });
        });
        return root;
      };

      // Get language from file extension for syntax highlighting
      const getLangFromPath = (path) => {
        const ext = path.split('.').pop().toLowerCase();
        const map = {
          js: 'javascript', jsx: 'javascript', ts: 'typescript', tsx: 'typescript',
          py: 'python', rb: 'ruby', rs: 'rust', go: 'go', java: 'java',
          c: 'c', h: 'c', cpp: 'cpp', hpp: 'cpp', cs: 'csharp',
          html: 'xml', htm: 'xml', xml: 'xml', svg: 'xml',
          css: 'css', scss: 'scss', less: 'less',
          json: 'json', yaml: 'yaml', yml: 'yaml', toml: 'ini',
          md: 'markdown', sh: 'bash', bash: 'bash', zsh: 'bash',
          sql: 'sql', php: 'php', swift: 'swift', kt: 'kotlin',
          dockerfile: 'dockerfile', makefile: 'makefile',
          lua: 'lua', r: 'r', dart: 'dart', vue: 'xml', svelte: 'xml',
        };
        return map[ext] || 'plaintext';
      };

      // Fetch list of markdown files in the repo
      useEffect(() => {
        const fetchDocs = async () => {
          setDocsLoading(true);
          try {
            const response = await fetch(
              `https://api.github.com/repos/${username}/${repo.name}/git/trees/HEAD?recursive=1`
            );
            if (response.ok) {
              const data = await response.json();
              const allBlobs = data.tree.filter(f => f.type === 'blob');
              const mdFiles = allBlobs
                .filter(f => /\.(md|markdown)$/i.test(f.path))
                .map(f => f.path)
                .sort((a, b) => {
                  if (a.toLowerCase().includes('readme')) return -1;
                  if (b.toLowerCase().includes('readme')) return 1;
                  return a.localeCompare(b);
                });
              setDocs(mdFiles.length > 0 ? mdFiles : ['README.md']);
              // Default to first README (sorted first), or fallback to README.md
              setSelectedDoc(mdFiles.length > 0 ? mdFiles[0] : 'README.md');
              // Store all code files (non-markdown blobs)
              const allCodeFiles = allBlobs
                .filter(f => !/\.(md|markdown)$/i.test(f.path))
                .map(f => f.path)
                .sort();
              setCodeFiles(allCodeFiles);
            } else {
              setDocs(['README.md']);
            }
          } catch {
            setDocs(['README.md']);
          } finally {
            setDocsLoading(false);
          }
        };
        fetchDocs();
      }, [repo.name, username]);

      // Fetch selected document content
      useEffect(() => {
        if (viewMode !== 'docs') return;
        const fetchContent = async () => {
          setLoading(true);
          try {
            const response = await fetch(
              `https://api.github.com/repos/${username}/${repo.name}/contents/${selectedDoc}`
            );
            if (response.ok) {
              const data = await response.json();
              setContent(atob(data.content));
            } else {
              setContent('');
            }
          } catch {
            setContent('');
          } finally {
            setLoading(false);
          }
        };
        if (selectedDoc) fetchContent();
      }, [selectedDoc, repo.name, username, viewMode]);

      // Fetch selected code file content
      useEffect(() => {
        if (viewMode !== 'code' || !selectedCodeFile) return;
        const fetchCode = async () => {
          setCodeContentLoading(true);
          try {
            const response = await fetch(
              `https://api.github.com/repos/${username}/${repo.name}/contents/${selectedCodeFile}`
            );
            if (response.ok) {
              const data = await response.json();
              setCodeContent(atob(data.content));
            } else {
              setCodeContent('');
            }
          } catch {
            setCodeContent('');
          } finally {
            setCodeContentLoading(false);
          }
        };
        fetchCode();
      }, [selectedCodeFile, repo.name, username, viewMode]);

      useEffect(() => {
        const handleEsc = (e) => e.key === 'Escape' && onClose();
        window.addEventListener('keydown', handleEsc);
        document.body.style.overflow = 'hidden';
        return () => {
          window.removeEventListener('keydown', handleEsc);
          document.body.style.overflow = '';
        };
      }, [onClose]);

      const getFileName = (path) => path.split('/').pop();

      const currentFiles = viewMode === 'docs' ? docs : codeFiles;
      const currentSelected = viewMode === 'docs' ? selectedDoc : selectedCodeFile;
      const setCurrentSelected = viewMode === 'docs' ? setSelectedDoc : setSelectedCodeFile;
      const isTreeLoading = viewMode === 'docs' ? docsLoading : docsLoading; // both come from same fetch

      // Render highlighted code
      const renderCodeContent = (code, filePath) => {
        const lang = getLangFromPath(filePath);
        const validLang = hljs.getLanguage(lang) ? lang : 'plaintext';
        try {
          return hljs.highlight(code, { language: validLang, ignoreIllegals: true }).value;
        } catch {
          return code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
      };

      // Render tree nodes (shared between docs and code views)
      const renderTree = () => {
        const tree = buildTree(currentFiles);
        const renderNode = (node, path, depth) => {
          const folderEntries = Object.keys(node.children).sort();
          const pl = `${0.75 + depth * 0.75}rem`;
          return (
            <React.Fragment key={path || 'root'}>
              {folderEntries.map(name => {
                const folderPath = path ? `${path}/${name}` : name;
                const isExpanded = expandedFolders[folderPath];
                return (
                  <React.Fragment key={folderPath}>
                    <button onClick={() => toggleFolder(folderPath)}
                            className="w-full text-left py-1.5 text-sm font-mono transition-colors flex items-center gap-1.5
                                     text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200"
                            style={{ paddingLeft: pl }}>
                      <Icon name={isExpanded ? 'ChevronDown' : 'ChevronRight'} size={12} className="text-zinc-600 shrink-0" />
                      <Icon name={isExpanded ? 'FolderOpen' : 'Folder'} size={14} className="text-amber-500/70 shrink-0" />
                      <span className="truncate">{name}</span>
                    </button>
                    {isExpanded && renderNode(node.children[name], folderPath, depth + 1)}
                  </React.Fragment>
                );
              })}
              {node.files.map(file => (
                <button key={file.path}
                        onClick={() => setCurrentSelected(file.path)}
                        className={`w-full text-left py-1.5 text-sm font-mono transition-colors flex items-center gap-1.5
                                  ${currentSelected === file.path
                                    ? 'bg-amber-500/20 text-amber-400 border-r-2 border-amber-500'
                                    : 'text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200'}`}
                        style={{ paddingLeft: `${0.75 + (depth + 0.5) * 0.75}rem` }}>
                  <Icon name={viewMode === 'code' ? 'FileCode' : 'FileText'} size={14}
                        className={currentSelected === file.path ? 'text-amber-500 shrink-0' : 'text-zinc-600 shrink-0'} />
                  <span className="truncate">{file.name}</span>
                </button>
              ))}
            </React.Fragment>
          );
        };
        return <div className="py-1">{renderNode(tree, '', 0)}</div>;
      };

      const displayedPath = viewMode === 'docs' ? (selectedDoc || '') : (selectedCodeFile || '');

      return (
        <div className="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4"
             onClick={onClose}>
          <div className="bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-6xl h-[95vh] overflow-hidden shadow-2xl flex flex-col"
               onClick={e => e.stopPropagation()}>
            {/* Header */}
            <div className="bg-zinc-800 border-b border-zinc-700 p-3 flex items-center justify-between shrink-0">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:bg-red-400" onClick={onClose}></div>
                  <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <button onClick={() => setSidebarOpen(!sidebarOpen)}
                        className="p-1 hover:bg-zinc-700 rounded transition-colors lg:hidden">
                  <Icon name={sidebarOpen ? 'PanelLeftClose' : 'PanelLeft'} size={16} className="text-zinc-400" />
                </button>
                <div className="flex items-center gap-2">
                  <Icon name={viewMode === 'docs' ? 'BookOpen' : 'Code'} size={18} className="text-amber-500" />
                  <span className="font-mono text-zinc-200 font-bold">{repo.name}</span>
                  {displayedPath && (
                    <span className="text-zinc-500 font-mono text-sm hidden sm:inline">/ {displayedPath}</span>
                  )}
                </div>
              </div>
              <div className="flex items-center gap-2">
                {/* View mode toggle */}
                <div className="flex bg-zinc-700/50 rounded-lg p-0.5">
                  <button onClick={() => setViewMode('docs')}
                          className={`flex items-center gap-1.5 px-2.5 py-1 rounded-md font-mono text-xs transition-all
                                    ${viewMode === 'docs' ? 'bg-amber-500 text-zinc-900' : 'text-zinc-400 hover:text-zinc-200'}`}>
                    <Icon name="BookOpen" size={12} />
                    <span className="hidden sm:inline">Docs</span>
                  </button>
                  <button onClick={() => setViewMode('code')}
                          className={`flex items-center gap-1.5 px-2.5 py-1 rounded-md font-mono text-xs transition-all
                                    ${viewMode === 'code' ? 'bg-amber-500 text-zinc-900' : 'text-zinc-400 hover:text-zinc-200'}`}>
                    <Icon name="Code" size={12} />
                    <span className="hidden sm:inline">Code</span>
                  </button>
                </div>
                <a href={`${repo.html_url}/blob/HEAD/${displayedPath}`} target="_blank" rel="noopener noreferrer"
                   className="flex items-center gap-1.5 text-zinc-400 hover:text-amber-400 transition-colors text-sm px-2 py-1 rounded hover:bg-zinc-700">
                  <Icon name="Github" size={14} />
                  <span className="hidden sm:inline">View on GitHub</span>
                </a>
                <button onClick={onClose} className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded">
                  <Icon name="X" size={20} />
                </button>
              </div>
            </div>

            {/* Main content area */}
            <div className="flex flex-1 overflow-hidden">
              {/* Sidebar - File tree */}
              <div className={`${sidebarOpen ? 'w-64' : 'w-0'} shrink-0 bg-zinc-850 border-r border-zinc-700 overflow-hidden transition-all duration-200`}
                   style={{ backgroundColor: '#1a1a1f' }}>
                <div className="p-3 border-b border-zinc-700">
                  <h3 className="text-xs font-mono text-zinc-500 uppercase tracking-wider flex items-center gap-2">
                    <Icon name={viewMode === 'docs' ? 'Files' : 'FolderCode'} size={14} />
                    {viewMode === 'docs' ? 'Documentation' : 'Source Code'}
                  </h3>
                </div>
                <div className="overflow-y-auto h-[calc(100%-48px)]">
                  {isTreeLoading ? (
                    <div className="p-4 text-center">
                      <div className="animate-spin rounded-full h-5 w-5 border-t-2 border-amber-500 mx-auto"></div>
                    </div>
                  ) : currentFiles.length === 0 ? (
                    <div className="p-4 text-center text-zinc-600 font-mono text-xs">
                      No files found
                    </div>
                  ) : renderTree()}
                </div>
              </div>

              {/* Content area */}
              <div className="flex-1 overflow-y-auto">
                {/* Stats bar */}
                <div className="bg-zinc-800/30 border-b border-zinc-700/50 px-4 py-2 flex flex-wrap gap-4 text-xs shrink-0">
                  <div className="flex items-center gap-1.5">
                    <Icon name="Star" size={14} className="text-amber-500" />
                    <span className="text-zinc-400">{repo.stargazers_count}</span>
                  </div>
                  <div className="flex items-center gap-1.5">
                    <Icon name="GitFork" size={14} className="text-zinc-500" />
                    <span className="text-zinc-400">{repo.forks_count}</span>
                  </div>
                  {repo.language && (
                    <div className="flex items-center gap-1.5">
                      <span className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: languageColors[repo.language] || '#6b7280' }}></span>
                      <span className="text-zinc-400">{repo.language}</span>
                    </div>
                  )}
                  {repo.license && (
                    <div className="flex items-center gap-1.5">
                      <Icon name="Scale" size={14} className="text-zinc-500" />
                      <span className="text-zinc-400">{repo.license.spdx_id || repo.license.name}</span>
                    </div>
                  )}
                  {repo.description && (
                    <div className="flex-1 text-zinc-500 truncate hidden md:block">
                      {repo.description}
                    </div>
                  )}
                </div>

                {/* Content */}
                {viewMode === 'docs' ? (
                  <div className="p-6 md:p-8">
                    {loading || !selectedDoc ? (
                      <div className="flex items-center justify-center py-12">
                        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-amber-500"></div>
                        <span className="ml-3 text-zinc-400 font-mono">Loading {selectedDoc ? getFileName(selectedDoc) : 'README'}...</span>
                      </div>
                    ) : content ? (
                      <div className="markdown-body max-w-none"
                           dangerouslySetInnerHTML={{ __html: renderMarkdown(content) }} />
                    ) : (
                      <div className="text-center py-12 text-zinc-500">
                        <Icon name="FileQuestion" size={48} className="mx-auto mb-4 opacity-50" />
                        <p className="font-mono">Document not found: {selectedDoc}</p>
                        <p className="text-sm mt-2">This file may not exist in the repository.</p>
                      </div>
                    )}
                  </div>
                ) : (
                  <div className="p-0">
                    {!selectedCodeFile ? (
                      <div className="text-center py-12 text-zinc-500">
                        <Icon name="FileCode" size={48} className="mx-auto mb-4 opacity-50" />
                        <p className="font-mono">Select a file to view</p>
                      </div>
                    ) : codeContentLoading ? (
                      <div className="flex items-center justify-center py-12">
                        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-amber-500"></div>
                        <span className="ml-3 text-zinc-400 font-mono">Loading {getFileName(selectedCodeFile)}...</span>
                      </div>
                    ) : codeContent ? (
                      <div className="relative">
                        <div className="bg-zinc-800/50 border-b border-zinc-700/50 px-4 py-1.5 flex items-center justify-between">
                          <span className="font-mono text-xs text-zinc-500">{selectedCodeFile}</span>
                          <button onClick={() => { navigator.clipboard.writeText(codeContent); }}
                                  className="text-xs text-zinc-500 hover:text-zinc-300 font-mono px-2 py-0.5 rounded hover:bg-zinc-700 transition-colors">
                            Copy
                          </button>
                        </div>
                        <pre className="p-4 overflow-x-auto text-sm leading-relaxed"><code
                          className={`hljs language-${getLangFromPath(selectedCodeFile)}`}
                          dangerouslySetInnerHTML={{ __html: renderCodeContent(codeContent, selectedCodeFile) }}
                        /></pre>
                      </div>
                    ) : (
                      <div className="text-center py-12 text-zinc-500">
                        <Icon name="FileQuestion" size={48} className="mx-auto mb-4 opacity-50" />
                        <p className="font-mono">File not found: {selectedCodeFile}</p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Navigation Tab Button
    const NavTab = ({ active, icon, label, onClick }) => (
      <button onClick={onClick}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg font-mono text-sm transition-all
                        ${active
                          ? 'bg-amber-500 text-zinc-900 shadow-lg shadow-amber-500/20'
                          : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200'}`}>
        <Icon name={icon} size={16} />
        <span className="hidden sm:inline">{label}</span>
      </button>
    );

    // Login Modal
    const LoginModal = ({ onLogin, onClose }) => {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        if (password === CONFIG.ADMIN_PASSWORD) {
          onLogin();
        } else {
          setError('Invalid password');
          setPassword('');
        }
      };

      useEffect(() => {
        const handleEsc = (e) => e.key === 'Escape' && onClose();
        window.addEventListener('keydown', handleEsc);
        return () => window.removeEventListener('keydown', handleEsc);
      }, [onClose]);

      return (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4"
             onClick={onClose}>
          <div className="bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-sm shadow-2xl"
               onClick={e => e.stopPropagation()}>
            <div className="bg-zinc-800 border-b border-zinc-700 p-3 flex items-center justify-between rounded-t-xl">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:bg-red-400" onClick={onClose}></div>
                  <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div className="flex items-center gap-2">
                  <Icon name="Lock" size={16} className="text-amber-500" />
                  <span className="font-mono text-zinc-200 text-sm font-bold">Admin Login</span>
                </div>
              </div>
              <button onClick={onClose} className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded">
                <Icon name="X" size={18} />
              </button>
            </div>
            <form onSubmit={handleSubmit} className="p-6">
              <label className="block font-mono text-xs text-zinc-500 mb-2">
                <span className="text-green-400">$</span> enter password
              </label>
              <input type="password" value={password} onChange={(e) => { setPassword(e.target.value); setError(''); }}
                     autoFocus placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                     className="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 font-mono text-sm
                              placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none mb-3" />
              {error && (
                <p className="text-red-400 text-xs font-mono mb-3">
                  <span className="text-red-500">error:</span> {error}
                </p>
              )}
              <button type="submit"
                      className="w-full bg-amber-500 hover:bg-amber-400 text-zinc-900 font-mono font-bold text-sm
                               py-2.5 rounded-lg transition-colors">
                Authenticate
              </button>
            </form>
          </div>
        </div>
      );
    };

    // Embedded App View - iframe for local apps
    const EmbeddedApp = ({ app, isAdmin }) => {
      const isFullscreen = app.fullscreen;
      const iframeRef = React.useRef(null);

      // Broadcast admin state to iframe on mount and when isAdmin changes
      React.useEffect(() => {
        const iframe = iframeRef.current;
        if (!iframe) return;
        const sendAuth = () => {
          try {
            iframe.contentWindow.postMessage({
              type: 'admin-auth',
              isAdmin: !!isAdmin,
              key: isAdmin ? CONFIG.ADMIN_PASSWORD : null
            }, '*');
          } catch(e) {}
        };
        // Send on load and on admin change
        iframe.addEventListener('load', sendAuth);
        sendAuth();
        return () => iframe.removeEventListener('load', sendAuth);
      }, [isAdmin]);

      return (
        <div className={`relative w-full bg-zinc-900 overflow-hidden shadow-2xl ${
          isFullscreen
            ? 'h-[calc(100vh-64px)] border-t border-zinc-700'
            : 'h-[calc(100vh-160px)] min-h-[600px] rounded-xl border border-zinc-700'
        }`}>
          {/* App header bar */}
          {!isFullscreen && (
            <div className="bg-zinc-800 border-b border-zinc-700 px-4 py-2 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-2.5 h-2.5 rounded-full bg-red-500/80"></div>
                  <div className="w-2.5 h-2.5 rounded-full bg-yellow-500/80"></div>
                  <div className="w-2.5 h-2.5 rounded-full bg-green-500/80"></div>
                </div>
                <div className="flex items-center gap-2">
                  <Icon name={app.icon} size={16} className="text-amber-500" />
                  <span className="font-mono text-zinc-300 text-sm font-medium">{app.name}</span>
                  {app.isLocal && (
                    <span className="text-xs bg-green-500/20 text-green-400 px-1.5 py-0.5 rounded font-mono">local</span>
                  )}
                </div>
              </div>
              <a href={app.url} target="_blank" rel="noopener noreferrer"
                 className="flex items-center gap-1.5 bg-zinc-700 hover:bg-zinc-600 text-zinc-300 text-xs font-mono px-3 py-1.5 rounded-lg transition-colors">
                <Icon name="ExternalLink" size={12} />
                Open in new tab
              </a>
            </div>
          )}
          {/* iframe - works with local files */}
          <iframe ref={iframeRef} src={app.url}
                  className={`w-full border-0 ${isFullscreen ? 'h-full' : 'h-[calc(100%-44px)]'}`}
                  title={app.name}
                  allow="camera; microphone; clipboard-read; clipboard-write" />
        </div>
      );
    };

    // Main App
    function App() {
      const [repos, setRepos] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedLanguage, setSelectedLanguage] = useState('all');
      const [sortBy, setSortBy] = useState('updated');
      const [selectedRepo, setSelectedRepo] = useState(null);
      const [username, setUsername] = useState(CONFIG.GITHUB_USERNAME);
      const [activeView, setActiveView] = useState('projects'); // 'projects', 'forked-projects', or app id
      const [isAdmin, setIsAdmin] = useState(false);
      const [showLoginModal, setShowLoginModal] = useState(false);
      const [hiddenRepos, setHiddenRepos] = useState(() => {
        try { return JSON.parse(localStorage.getItem('hiddenRepos') || '[]'); }
        catch { return []; }
      });
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

      const toggleHideRepo = (repoName) => {
        setHiddenRepos(prev => {
          const next = prev.includes(repoName) ? prev.filter(n => n !== repoName) : [...prev, repoName];
          localStorage.setItem('hiddenRepos', JSON.stringify(next));
          return next;
        });
      };

      // Fetch repos
      useEffect(() => {
        if (username === 'YOUR_GITHUB_USERNAME') {
          setLoading(false);
          return;
        }

        const fetchRepos = async () => {
          setLoading(true);
          setError(null);
          try {
            const response = await fetch(
              `https://api.github.com/users/${username}/repos?per_page=${CONFIG.MAX_REPOS}&sort=updated`
            );
            if (!response.ok) {
              if (response.status === 404) throw new Error('User not found');
              throw new Error('Failed to fetch repositories');
            }
            let data = await response.json();

            // Apply filters
            if (CONFIG.HIDE_FORKS) data = data.filter(r => !r.fork);
            if (CONFIG.EXCLUDE_REPOS.length) {
              data = data.filter(r => !CONFIG.EXCLUDE_REPOS.includes(r.name));
            }
            if (CONFIG.FILTER_TOPICS.length) {
              data = data.filter(r =>
                r.topics && r.topics.some(t => CONFIG.FILTER_TOPICS.includes(t))
              );
            }

            setRepos(data);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };
        fetchRepos();
      }, [username]);

      // Get languages
      const languages = useMemo(() => {
        const langs = [...new Set(repos.map(r => r.language).filter(Boolean))];
        return ['all', ...langs.sort()];
      }, [repos]);

      // Filter and sort
      const filteredRepos = useMemo(() => {
        let filtered = repos;

        // Hide hidden repos for non-admin users
        if (!isAdmin) {
          filtered = filtered.filter(r => !hiddenRepos.includes(r.name));
        }

        if (searchTerm) {
          const term = searchTerm.toLowerCase();
          filtered = filtered.filter(r =>
            r.name.toLowerCase().includes(term) ||
            (r.description && r.description.toLowerCase().includes(term)) ||
            (r.topics && r.topics.some(t => t.toLowerCase().includes(term)))
          );
        }

        if (selectedLanguage !== 'all') {
          filtered = filtered.filter(r => r.language === selectedLanguage);
        }

        if (activeView === 'forked-projects') {
          filtered = filtered.filter(r => r.fork);
        } else {
          filtered = filtered.filter(r => !r.fork);
        }

        return filtered.sort((a, b) => {
          switch (sortBy) {
            case 'stars': return b.stargazers_count - a.stargazers_count;
            case 'name': return a.name.localeCompare(b.name);
            default: return new Date(b.updated_at) - new Date(a.updated_at);
          }
        });
      }, [repos, searchTerm, selectedLanguage, activeView, sortBy, isAdmin, hiddenRepos]);

      return (
        <div className="min-h-screen bg-zinc-950 text-zinc-100">
          {/* Grid background */}
          <div className="fixed inset-0 opacity-5 pointer-events-none"
               style={{ backgroundImage: 'linear-gradient(rgba(251,191,36,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(251,191,36,0.3) 1px, transparent 1px)',
                        backgroundSize: '50px 50px' }}></div>

          {/* Header */}
          <header className="relative border-b border-zinc-800 bg-zinc-900/80 backdrop-blur-sm sticky top-0 z-40">
            <div className="max-w-7xl mx-auto px-4 py-4">
              <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div className="flex items-center gap-3">
                  <div className="p-2 bg-amber-500/20 rounded-lg border border-amber-500/30">
                    <Icon name="Wrench" size={28} className="text-amber-500" />
                  </div>
                  <div>
                    <h1 className="text-xl font-mono font-bold">
                      <span className="text-amber-500">$</span> {CONFIG.SITE_TITLE.toLowerCase().replace(/\s/g, '_')}
                    </h1>
                    <p className="text-zinc-500 text-xs font-mono">
                      <span className="text-green-400">â†’</span> {CONFIG.TAGLINE}
                    </p>
                  </div>
                </div>

                {/* Navigation Tabs - desktop */}
                <div className="hidden lg:flex items-center gap-2">
                  <NavTab active={activeView === 'projects'} icon="FolderGit2" label="Original Projects"
                          onClick={() => setActiveView('projects')} />
                  <NavTab active={activeView === 'forked-projects'} icon="GitFork" label="Forked Projects"
                          onClick={() => setActiveView('forked-projects')} />
                  {CONFIG.INTEGRATED_APPS.filter(app => !app.requiresAdmin || isAdmin).map(app => (
                    <NavTab key={app.id} active={activeView === app.id} icon={app.icon} label={app.name}
                            onClick={() => setActiveView(app.id)} />
                  ))}
                </div>

                {/* Hamburger button - mobile/tablet */}
                <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                        className="lg:hidden flex items-center gap-2 px-3 py-2 rounded-lg bg-zinc-800 border border-zinc-700
                                   text-zinc-300 hover:bg-zinc-700 hover:text-zinc-100 transition-colors font-mono text-sm">
                  <Icon name={mobileMenuOpen ? 'X' : 'Menu'} size={18} />
                  <span className="hidden sm:inline">
                    {(() => {
                      if (activeView === 'projects') return 'Original Projects';
                      if (activeView === 'forked-projects') return 'Forked Projects';
                      const app = CONFIG.INTEGRATED_APPS.find(a => a.id === activeView);
                      return app ? app.name : 'Menu';
                    })()}
                  </span>
                </button>

                <div className="flex items-center gap-3">
                  <a href={`https://github.com/${username}`} target="_blank" rel="noopener noreferrer"
                     className="flex items-center gap-2 text-zinc-400 hover:text-amber-400 transition-colors">
                    <Icon name="Github" size={18} />
                    <span className="font-mono text-sm">@{username}</span>
                  </a>
                  {isAdmin ? (
                    <button onClick={() => setIsAdmin(false)}
                            className="flex items-center gap-1.5 bg-amber-500/20 text-amber-400 hover:bg-amber-500/30
                                     px-3 py-1.5 rounded-lg font-mono text-xs transition-colors border border-amber-500/30">
                      <Icon name="LogOut" size={14} />
                      <span className="hidden sm:inline">Logout</span>
                    </button>
                  ) : (
                    <button onClick={() => setShowLoginModal(true)}
                            className="flex items-center gap-1.5 bg-zinc-800 text-zinc-500 hover:text-zinc-300
                                     hover:bg-zinc-700 px-3 py-1.5 rounded-lg font-mono text-xs transition-colors border border-zinc-700">
                      <Icon name="Lock" size={14} />
                      <span className="hidden sm:inline">Login</span>
                    </button>
                  )}
                </div>
              </div>
            </div>
          </header>

          {/* Mobile navigation menu */}
          {mobileMenuOpen && (
            <div className="lg:hidden fixed inset-0 z-50" onClick={() => setMobileMenuOpen(false)}>
              <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" />
              <div className="absolute top-0 left-0 right-0 bg-zinc-900 border-b border-zinc-700 shadow-2xl shadow-black/50"
                   onClick={e => e.stopPropagation()}>
                {/* Menu header */}
                <div className="flex items-center justify-between px-4 py-3 border-b border-zinc-800">
                  <span className="font-mono text-sm text-zinc-400">
                    <span className="text-green-400">$</span> navigate
                  </span>
                  <button onClick={() => setMobileMenuOpen(false)}
                          className="p-1.5 rounded-lg hover:bg-zinc-800 text-zinc-500 hover:text-zinc-300 transition-colors">
                    <Icon name="X" size={20} />
                  </button>
                </div>
                {/* Menu items */}
                <div className="p-3 grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-[70vh] overflow-y-auto">
                  {[
                    { id: 'projects', icon: 'FolderGit2', name: 'Original Projects' },
                    { id: 'forked-projects', icon: 'GitFork', name: 'Forked Projects' },
                    ...CONFIG.INTEGRATED_APPS.filter(app => !app.requiresAdmin || isAdmin)
                      .map(app => ({ id: app.id, icon: app.icon, name: app.name }))
                  ].map(item => (
                    <button key={item.id}
                            onClick={() => { setActiveView(item.id); setMobileMenuOpen(false); }}
                            className={`flex items-center gap-3 px-3 py-3 rounded-lg font-mono text-sm transition-all text-left
                                      ${activeView === item.id
                                        ? 'bg-amber-500 text-zinc-900 shadow-lg shadow-amber-500/20'
                                        : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200 border border-zinc-700'}`}>
                      <Icon name={item.icon} size={18} />
                      <span className="truncate">{item.name}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Filters - show in projects and forked-projects views */}
          {(activeView === 'projects' || activeView === 'forked-projects') && !loading && !error && (
            <div className="border-b border-zinc-800 bg-zinc-900/50 backdrop-blur-sm sticky top-[72px] z-30">
              <div className="max-w-7xl mx-auto px-4 py-4">
                <div className="flex flex-col sm:flex-row gap-4">
                  <div className="relative flex-1">
                    <Icon name="Search" size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500" />
                    <input type="text" placeholder="Search projects..."
                           value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}
                           className="w-full bg-zinc-800 border border-zinc-700 rounded-lg pl-10 pr-4 py-2.5 font-mono text-sm
                                    placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none" />
                  </div>
                  <div className="relative">
                    <select value={selectedLanguage} onChange={(e) => setSelectedLanguage(e.target.value)}
                            className="appearance-none bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 pr-10 font-mono text-sm
                                     focus:border-amber-500 focus:outline-none cursor-pointer min-w-[140px]">
                      {languages.map(lang => (
                        <option key={lang} value={lang}>{lang === 'all' ? 'All Languages' : lang}</option>
                      ))}
                    </select>
                    <Icon name="ChevronDown" size={16} className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none" />
                  </div>
                  <div className="relative">
                    <select value={sortBy} onChange={(e) => setSortBy(e.target.value)}
                            className="appearance-none bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 pr-10 font-mono text-sm
                                     focus:border-amber-500 focus:outline-none cursor-pointer min-w-[160px]">
                      <option value="updated">Recently Updated</option>
                      <option value="stars">Most Stars</option>
                      <option value="name">Alphabetical</option>
                    </select>
                    <Icon name="ChevronDown" size={16} className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none" />
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Fullscreen App View - rendered outside main container */}
          {activeView !== 'projects' && activeView !== 'forked-projects' && (() => {
            const app = CONFIG.INTEGRATED_APPS.find(a => a.id === activeView);
            if (app && app.requiresAdmin && !isAdmin) return null;
            return app && app.fullscreen ? <EmbeddedApp app={app} isAdmin={isAdmin} /> : null;
          })()}

          {/* Main */}
          <main className="max-w-7xl mx-auto px-4 py-6 relative">
            {/* Embedded App View (non-fullscreen) */}
            {activeView !== 'projects' && activeView !== 'forked-projects' && (() => {
              const app = CONFIG.INTEGRATED_APPS.find(a => a.id === activeView);
              if (app && app.requiresAdmin && !isAdmin) return null;
              return app && !app.fullscreen ? <EmbeddedApp app={app} isAdmin={isAdmin} /> : null;
            })()}

            {/* Projects View */}
            {(activeView === 'projects' || activeView === 'forked-projects') && (
              <>
                {loading ? (
                  <div className="flex flex-col items-center justify-center py-20">
                    <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-amber-500 mb-4"></div>
                    <p className="font-mono text-zinc-400">Fetching projects from GitHub...</p>
                  </div>
                ) : error ? (
                  <div className="text-center py-20">
                    <div className="bg-red-500/10 border border-red-500/30 rounded-lg p-6 max-w-md mx-auto">
                      <Icon name="AlertCircle" size={32} className="mx-auto mb-3 text-red-400" />
                      <p className="text-red-400 font-mono">{error}</p>
                      <p className="text-zinc-500 text-sm mt-2">Check the username and try again.</p>
                    </div>
                  </div>
                ) : (
                  <>
                    <div className="mb-6 font-mono text-sm text-zinc-500">
                      <span className="text-green-400">â†’</span> Found <span className="text-amber-400">{filteredRepos.length}</span> projects
                      {searchTerm && <span> matching "{searchTerm}"</span>}
                    </div>

                    {filteredRepos.length > 0 ? (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredRepos.map(repo => (
                          <ProjectCard key={repo.id} repo={repo} onClick={() => setSelectedRepo(repo)}
                                       isAdmin={isAdmin} isHidden={hiddenRepos.includes(repo.name)}
                                       onToggleHide={toggleHideRepo} />
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-20">
                        <Icon name="Package" size={48} className="mx-auto mb-4 text-zinc-600" />
                        <p className="font-mono text-zinc-500">No projects match your filters</p>
                      </div>
                    )}
                  </>
                )}
              </>
            )}
          </main>

          {/* Footer */}
          <footer className="border-t border-zinc-800 bg-zinc-900/50 py-8 mt-12">
            <div className="max-w-7xl mx-auto px-4 text-center space-y-2">
              <p className="font-mono text-sm text-zinc-600">
                <span className="text-amber-500/50">/*</span> Built with React â€¢ Powered by GitHub API <span className="text-amber-500/50">*/</span>
              </p>
              <div className="flex items-center justify-center gap-3 font-mono text-xs text-zinc-700">
                {BUILD_COMMIT !== 'dev' && (
                  <>
                    <a href={`https://github.com/${username}/pages/commit/${BUILD_COMMIT}`}
                       target="_blank" rel="noopener noreferrer"
                       className="flex items-center gap-1 hover:text-zinc-500 transition-colors">
                      <Icon name="GitCommitHorizontal" size={12} />
                      <span>{BUILD_COMMIT.slice(0, 7)}</span>
                    </a>
                    <span className="text-zinc-800">â€¢</span>
                  </>
                )}
                <span className="flex items-center gap-1">
                  <Icon name="Calendar" size={12} />
                  <span>{BUILD_DATE !== 'dev' ? BUILD_DATE : 'development'}</span>
                </span>
              </div>
            </div>
          </footer>

          {/* Login Modal */}
          {showLoginModal && (
            <LoginModal onLogin={() => { setIsAdmin(true); setShowLoginModal(false); }}
                        onClose={() => setShowLoginModal(false)} />
          )}

          {/* Documentation Reader Modal */}
          {selectedRepo && (
            <ProjectModal key={selectedRepo.id} repo={selectedRepo} username={username}
                          onClose={() => setSelectedRepo(null)} />
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
