<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Black Sphere Industries | GitHub Projects</title>
  <meta name="description" content="A portfolio of maker and tinkerer projects, powered by GitHub">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="zwartbol-icon.svg">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4182327423467372"
     crossorigin="anonymous"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwindcss.config = {
      theme: {
        extend: {
          fontFamily: {
            mono: ['JetBrains Mono', 'monospace'],
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <!-- Markdown Parser & Syntax Highlighting -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">

  <style>
    * { font-family: 'Inter', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace !important; }

    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #18181b; }
    ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #52525b; }

    /* Line clamp */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Animation */
    @keyframes spin { to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }

    /* Markdown Prose Styles */
    .markdown-body { color: #a1a1aa; line-height: 1.7; }
    .markdown-body h1 { font-size: 1.875rem; font-weight: 700; color: #f59e0b; margin-top: 1.5rem; margin-bottom: 1rem; font-family: 'JetBrains Mono', monospace; border-bottom: 1px solid #3f3f46; padding-bottom: 0.5rem; }
    .markdown-body h2 { font-size: 1.5rem; font-weight: 600; color: #fbbf24; margin-top: 1.5rem; margin-bottom: 0.75rem; font-family: 'JetBrains Mono', monospace; border-bottom: 1px solid #3f3f46; padding-bottom: 0.5rem; }
    .markdown-body h3 { font-size: 1.25rem; font-weight: 600; color: #fcd34d; margin-top: 1.25rem; margin-bottom: 0.5rem; font-family: 'JetBrains Mono', monospace; }
    .markdown-body h4 { font-size: 1.125rem; font-weight: 600; color: #fde68a; margin-top: 1rem; margin-bottom: 0.5rem; font-family: 'JetBrains Mono', monospace; }
    .markdown-body p { margin-bottom: 1rem; }
    .markdown-body a { color: #f59e0b; text-decoration: underline; transition: color 0.2s; }
    .markdown-body a:hover { color: #fbbf24; }
    .markdown-body strong { color: #e4e4e7; font-weight: 600; }
    .markdown-body em { font-style: italic; }
    .markdown-body code:not(pre code) { background: #27272a; color: #4ade80; padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; }
    .markdown-body pre { background: #18181b; border: 1px solid #3f3f46; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
    .markdown-body pre code { background: transparent; padding: 0; font-size: 0.875rem; line-height: 1.5; }
    .markdown-body ul, .markdown-body ol { margin: 1rem 0; padding-left: 1.5rem; }
    .markdown-body ul { list-style-type: disc; }
    .markdown-body ol { list-style-type: decimal; }
    .markdown-body li { margin-bottom: 0.5rem; color: #d4d4d8; }
    .markdown-body li::marker { color: #f59e0b; }
    .markdown-body blockquote { border-left: 3px solid #f59e0b; padding-left: 1rem; margin: 1rem 0; color: #a1a1aa; font-style: italic; background: #27272a40; padding: 0.75rem 1rem; border-radius: 0 0.5rem 0.5rem 0; }
    .markdown-body img { max-width: 100%; border-radius: 0.5rem; margin: 1rem 0; border: 1px solid #3f3f46; }
    .markdown-body hr { border: none; border-top: 1px solid #3f3f46; margin: 2rem 0; }
    .markdown-body table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    .markdown-body th, .markdown-body td { border: 1px solid #3f3f46; padding: 0.75rem; text-align: left; }
    .markdown-body th { background: #27272a; color: #fbbf24; font-family: 'JetBrains Mono', monospace; font-weight: 600; }
    .markdown-body td { background: #18181b; }
    .markdown-body tr:hover td { background: #1f1f23; }
    .markdown-body input[type="checkbox"] { margin-right: 0.5rem; accent-color: #f59e0b; }
    .markdown-body .task-list-item { list-style-type: none; margin-left: -1.25rem; }

    /* Code block header */
    .code-block-wrapper { position: relative; margin: 1rem 0; }
    .code-block-header { background: #27272a; border: 1px solid #3f3f46; border-bottom: none; border-radius: 0.5rem 0.5rem 0 0; padding: 0.5rem 1rem; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #71717a; display: flex; justify-content: space-between; align-items: center; }
    .code-block-header + pre { margin-top: 0; border-radius: 0 0 0.5rem 0.5rem; }
    .copy-btn { background: #3f3f46; border: none; color: #a1a1aa; padding: 0.25rem 0.5rem; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem; transition: all 0.2s; }
    .copy-btn:hover { background: #52525b; color: #e4e4e7; }

    /* Inline emoji */
    .inline-emoji { display: inline; height: 1.2em; width: 1.2em; vertical-align: text-bottom; margin: 0 0.05em; }

    /* Splash screen */
    #splash {
      position: fixed; inset: 0; z-index: 9999;
      background: #000;
      display: flex; align-items: center; justify-content: center;
      transition: opacity 0.6s ease, visibility 0.6s ease;
    }
    #splash.fade-out { opacity: 0; visibility: hidden; }
    .splash-sphere {
      position: relative; width: 140px; height: 140px;
    }
    .splash-sphere .core {
      position: absolute; inset: 20px;
      border-radius: 50%;
      background: radial-gradient(circle at 38% 30%, #555 0%, #2a2a2a 30%, #000 100%);
    }
    .splash-sphere .corona {
      position: absolute; inset: 0;
      border-radius: 50%;
      box-shadow:
        0 0 40px 10px rgba(232,163,23,0.3),
        0 0 80px 30px rgba(232,163,23,0.15),
        0 0 120px 50px rgba(232,163,23,0.08);
      animation: corona-pulse 2s ease-in-out infinite;
    }
    .splash-sphere .ring {
      position: absolute; top: 50%; left: 50%;
      width: 180px; height: 40px;
      margin-left: -90px; margin-top: -20px;
      border: 2px solid transparent;
      border-image: linear-gradient(90deg, transparent 0%, #E8A317 30%, #C98B10 70%, transparent 100%) 1;
      border-top: none; border-bottom: none;
      border-radius: 50%;
      opacity: 0.6;
      animation: ring-rotate 4s linear infinite;
    }
    @keyframes corona-pulse {
      0%, 100% { box-shadow: 0 0 40px 10px rgba(232,163,23,0.3), 0 0 80px 30px rgba(232,163,23,0.15), 0 0 120px 50px rgba(232,163,23,0.08); }
      50% { box-shadow: 0 0 50px 15px rgba(232,163,23,0.4), 0 0 100px 40px rgba(232,163,23,0.2), 0 0 140px 60px rgba(232,163,23,0.1); }
    }
    @keyframes ring-rotate {
      from { transform: rotateX(70deg) rotateZ(0deg); }
      to   { transform: rotateX(70deg) rotateZ(360deg); }
    }
    .splash-title {
      margin-top: 32px;
      font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
      font-size: 14px; font-weight: 600; letter-spacing: 2px;
      color: #E8A317; opacity: 0; text-align: center;
      animation: title-appear 0.8s ease 0.5s forwards;
    }
    .splash-tagline {
      margin-top: 8px;
      font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
      font-size: 10px; color: #E8A317; opacity: 0; text-align: center;
      animation: title-appear 0.8s ease 0.9s forwards;
    }
    @keyframes title-appear {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 0.7; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-zinc-950">
  <!-- Splash screen (pure HTML/CSS — renders before React) -->
  <div id="splash">
    <div style="display:flex;flex-direction:column;align-items:center;">
      <div class="splash-sphere">
        <div class="corona"></div>
        <div class="core"></div>
        <div class="ring"></div>
      </div>
      <div class="splash-title">BLACK SPHERE INDUSTRIES</div>
      <div class="splash-tagline">→ Building things that work (mostly)</div>
    </div>
  </div>

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ============================================
    // CONFIGURATION - CHANGE THESE VALUES
    // ============================================
    const CONFIG = {
      // Your GitHub username
      GITHUB_USERNAME: 'arnoutzw',

      // Maximum number of repos to fetch
      MAX_REPOS: 100,

      // Site title
      SITE_TITLE: 'Black Sphere Industries',

      // Tagline shown in header
      TAGLINE: 'Building things that work (mostly)',

      // Repos to exclude (by name)
      EXCLUDE_REPOS: [], // Exclude embedded apps and the pages repo itself

      // Only show repos with these topics (leave empty to show all)
      FILTER_TOPICS: [],

      // Hide forked repos
      HIDE_FORKS: false,

      // Admin password for login (enables hide/unhide repos)
      ADMIN_PASSWORD: 'admin',

      // Admin email addresses — SSO users with these emails get admin access
      ADMIN_EMAILS: [],

      // SSO providers to show on login modal
      SSO_PROVIDERS: ['google'],

      // Disciplines for grouping apps in navigation
      DISCIPLINES: [
        { id: 'planning', name: 'Planning', icon: 'ClipboardList' },
        { id: 'electrical', name: 'Electrical', icon: 'Zap' },
        { id: 'mechanical', name: 'Mechanical', icon: 'Cog' },
        { id: 'physics', name: 'Physics', icon: 'Atom' },
        { id: 'software', name: 'Software', icon: 'Monitor' },
        { id: 'fabrication', name: 'Fabrication', icon: 'Scissors' },
      ],

      // Apps grouped by discipline
      INTEGRATED_APPS: [
        // Electrical
        {
          id: 'datasheet-search-app',
          name: 'Datasheets',
          icon: 'FileSearch',
          url: 'https://arnoutzw.github.io/datasheet-search-app/',
          description: 'Search component datasheets',
          isLocal: false,
          fullscreen: true,
          discipline: 'electrical'
        },
        {
          id: 'circuit-sim',
          name: 'Circuit Sim',
          icon: 'Zap',
          url: 'https://www.falstad.com/circuit/circuitjs.html',
          description: 'Interactive circuit simulator',
          isLocal: false,
          fullscreen: true,
          discipline: 'electrical'
        },
        {
          id: 'filter-design-studio-app',
          name: 'Filter Design Studio',
          icon: 'AudioLines',
          url: 'https://arnoutzw.github.io/filter-design-studio-app/',
          description: 'Analog and digital filter design tool',
          isLocal: false,
          fullscreen: true,
          discipline: 'electrical'
        },
        {
          id: 'control-tuner-app',
          name: 'Control Loop Tuner',
          icon: 'Gauge',
          url: 'https://arnoutzw.github.io/control-tuner-app/',
          description: 'PID controller tuner with Bode plots and time-domain response',
          isLocal: false,
          fullscreen: true,
          discipline: 'electrical'
        },
        // Mechanical
        {
          id: 'engineering-calcs-app',
          name: 'Engineering Calculators',
          icon: 'Wrench',
          url: 'https://arnoutzw.github.io/engineering-calcs-app/',
          description: 'Tribology, bearings, fatigue & machine design calculators',
          isLocal: false,
          fullscreen: true,
          discipline: 'mechanical'
        },
        {
          id: 'gear-calculator',
          name: 'Gear Design Studio',
          icon: 'Cog',
          url: 'https://arnoutzw.github.io/gear_calculator/',
          description: 'Gear design and ratio calculator',
          isLocal: false,
          fullscreen: true,
          discipline: 'mechanical'
        },
        {
          id: 'kinematics-studio-app',
          name: 'Kinematics Studio',
          icon: 'Activity',
          url: 'https://arnoutzw.github.io/kinematics-studio-app/',
          description: 'Interactive kinematics and motion analysis tool',
          isLocal: false,
          fullscreen: true,
          discipline: 'mechanical',
          alternatives: [
            { name: 'Kinematics Studio', url: 'https://arnoutzw.github.io/kinematics-studio-app/', icon: 'Activity' },
            { name: 'Robot Arm Studio', url: 'https://arnoutzw.github.io/robot-arm-studio/', icon: 'Bot' }
          ]
        },
        {
          id: 'mech-fea-app',
          name: 'FEA Studio',
          icon: 'Grid3x3',
          url: 'https://arnoutzw.github.io/mech-fea-app/',
          description: 'Finite element analysis for mechanical structures',
          isLocal: false,
          fullscreen: true,
          discipline: 'mechanical'
        },
        {
          id: 'suspension-viz-app',
          name: 'Suspension Analysis',
          icon: 'CarFront',
          url: 'https://arnoutzw.github.io/suspension-viz-app/',
          description: 'Suspension geometry visualization and analysis',
          isLocal: false,
          fullscreen: true,
          discipline: 'mechanical'
        },
        // Physics
        {
          id: 'ray-optics',
          name: 'Ray Optics',
          icon: 'Sun',
          url: 'https://phydemo.app/ray-optics/simulator/',
          description: 'Interactive ray optics simulator',
          isLocal: false,
          fullscreen: true,
          discipline: 'physics'
        },
        {
          id: 'magfield-app',
          name: 'Magnetic Fields',
          icon: 'Magnet',
          url: 'https://arnoutzw.github.io/magfield-app/',
          description: 'Magnetic field visualization and simulation',
          isLocal: false,
          fullscreen: true,
          discipline: 'physics'
        },
        {
          id: 'vibration-mode-visualizer',
          name: 'Vibration Modes',
          icon: 'Waves',
          url: 'https://arnoutzw.github.io/vibration_mode_visualizer/',
          description: 'Visualize vibration mode shapes of beams and structures',
          isLocal: false,
          fullscreen: true,
          discipline: 'physics'
        },
        // Fabrication
        {
          id: 'label-designer-app',
          name: 'Label Designer',
          icon: 'PenTool',
          url: 'https://arnoutzw.github.io/label-designer-app/',
          description: 'Design and print custom labels',
          isLocal: false,
          fullscreen: true,
          discipline: 'fabrication'
        },
        {
          id: '3d-model-studio-app',
          name: '3D Model Studio',
          icon: 'Box',
          url: 'https://arnoutzw.github.io/3d-model-studio-app/',
          description: '3D model viewer and editor',
          isLocal: false,
          fullscreen: true,
          discipline: 'fabrication'
        },
        {
          id: 'g-code-viewer',
          name: 'G-code Viewer',
          icon: 'Scan',
          url: 'https://arnoutzw.github.io/g-code-viewer/',
          description: 'Preview and simulate CNC toolpaths',
          isLocal: false,
          fullscreen: true,
          discipline: 'fabrication'
        },
        {
          id: 'woodcut-optimizer',
          name: 'Woodcut Optimizer',
          icon: 'TreePine',
          url: 'https://arnoutzw.github.io/woodcut-optimizer/',
          description: 'Optimize cutting layouts for sheet and board stock',
          isLocal: false,
          fullscreen: true,
          discipline: 'fabrication'
        },
        // Planning
        {
          id: 'notes-app',
          name: 'Notes',
          icon: 'StickyNote',
          url: 'https://arnoutzw.github.io/Notes_App/',
          description: 'Note-taking app',
          isLocal: false,
          fullscreen: true,
          discipline: 'planning'
        },
        {
          id: 'scrum-app',
          name: 'Scrum Board',
          icon: 'KanbanSquare',
          url: 'https://arnoutzw.github.io/scrum-app/',
          description: 'Agile scrum board for project planning',
          isLocal: false,
          fullscreen: true,
          discipline: 'planning'
        },
        {
          id: 'lab-inventory-app',
          name: 'Lab Inventory',
          icon: 'Package',
          url: 'https://arnoutzw.github.io/lab-inventory-app/',
          description: 'Lab inventory and parts management',
          isLocal: false,
          fullscreen: true,
          discipline: 'planning'
        },
        {
          id: 'erp-app',
          name: 'ERP',
          icon: 'Building2',
          url: 'https://arnoutzw.github.io/erp-app/',
          description: 'Enterprise resource planning',
          isLocal: false,
          fullscreen: true,
          discipline: 'planning'
        },
        {
          id: 'alm-app',
          name: 'ALM',
          icon: 'GitBranch',
          url: 'https://arnoutzw.github.io/alm-app/',
          description: 'Application lifecycle management',
          isLocal: false,
          fullscreen: true,
          discipline: 'planning'
        },
        {
          id: 'req-management',
          name: 'Requirements',
          icon: 'ClipboardList',
          url: 'https://arnoutzw.github.io/req-management/',
          description: 'Requirements management',
          isLocal: false,
          fullscreen: true,
          discipline: 'planning'
        },
        // Software
        {
          id: 'serial-app',
          name: 'Serial Terminal',
          icon: 'Terminal',
          url: 'https://arnoutzw.github.io/serial-app/',
          description: 'Web serial terminal for communicating with devices',
          isLocal: false,
          fullscreen: true,
          discipline: 'software'
        },
        {
          id: 'jk-bms-app',
          name: 'JK BMS App',
          icon: 'BatteryCharging',
          url: 'https://arnoutzw.github.io/jk-bms-app/',
          description: 'JK BMS battery monitor',
          isLocal: false,
          fullscreen: true,
          discipline: 'software'
        },
        {
          id: 'pq-bms-app',
          name: 'PQ BMS Monitor',
          icon: 'Battery',
          url: 'https://arnoutzw.github.io/pq-bms-app/',
          description: 'Monitor Powerqueen LiFePO4 batteries via Bluetooth',
          isLocal: false,
          fullscreen: true,
          discipline: 'software'
        },
        {
          id: 'protocol-decoder-app',
          name: 'Protocol Decoder',
          icon: 'Binary',
          url: 'https://arnoutzw.github.io/protocol-decoder-app/',
          description: 'Decode SPI, I2C, UART and CAN protocol frames',
          isLocal: false,
          fullscreen: true,
          discipline: 'software'
        },
        {
          id: 'py-lab-app',
          name: 'PyLab',
          icon: 'FileCode',
          url: 'https://arnoutzw.github.io/py-lab-app/',
          description: 'Browser Python notebook with NumPy, SciPy and Matplotlib',
          isLocal: false,
          fullscreen: true,
          discipline: 'software'
        }
      ],
    };

    // ============================================
    // FIREBASE - GitHub cache database
    // ============================================
    const firebaseApp = firebase.initializeApp({
      apiKey: "AIzaSyAqRWVgti-CuXzr5AkhDKmPlu7iA2MQpUg",
      authDomain: "arnout-s-homelab.firebaseapp.com",
      projectId: "arnout-s-homelab",
      storageBucket: "arnout-s-homelab.firebasestorage.app",
      messagingSenderId: "258011834485",
      appId: "1:258011834485:web:5afb1efaa303b4dd93f03c",
      measurementId: "G-VXDKDLXP7L"
    });
    const db = firebaseApp.firestore();
    const auth = firebaseApp.auth();

    // SSO provider
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    // ============================================

    // ============================================
    // BUILD INFO - AUTO-UPDATED BY PRE-COMMIT HOOK
    // ============================================
    const BUILD_COMMIT = '18c665ca7b560b8b10dc5bcf983b59e32c3a538e';
    const BUILD_DATE = '2026-02-06';

    // Release notes per git hash, grouped by date
    const VERSION_HISTORY = [
      { hash: 'HEAD', date: '2026-02-13', changes: 'Add Firebase SSO authentication with Google sign-in for all PWAs' },
      { hash: 'HEAD', date: '2026-02-09', changes: 'Add ERP and Invoice Maker to Planning discipline' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add Scrum Board under new Planning discipline' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add Woodcut Optimizer to Fabrication discipline' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add Vibration Modes, Protocol Decoder and G-code Viewer' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add Suspension Viz to Mechanical discipline' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add Magnetic Fields to Physics and Robot Arm Studio as Kinematics alternative' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add FEA Studio to Mechanical discipline' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Consolidate Projects, Forks, Starred into GitHub dropdown' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add 3D Model Studio to Fabrication discipline' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Restructure navigation by engineering discipline with dropdown menus' },
      { hash: 'HEAD', date: '2026-02-08', changes: 'Add Kinematics Studio to integrated apps' },
      { hash: 'HEAD', date: '2026-02-07', changes: 'Add Gear Calculator to integrated apps' },
      { hash: 'HEAD', date: '2026-02-07', changes: 'Add starred repos tab to main page' },
      { hash: 'HEAD', date: '2026-02-07', changes: 'Sort apps by engineering lifecycle and add Serial Terminal' },
      { hash: '005d933', date: '2026-02-06', changes: 'Restyle Engineering Calculators to match portfolio\'s dark zinc/amber theme' },
      { hash: 'e6a46b3', date: '2026-02-06', changes: 'Add Engineering Calculators to main page integrated apps' },
      { hash: '1a93eaf', date: '2026-02-06', changes: 'Update print label CSS to specify 40x30mm label size' },
      { hash: '389d9db', date: '2026-02-06', changes: 'Add preferences menu with tab visibility toggles when logged in' },
      { hash: '4fa4c57', date: '2026-02-06', changes: 'Fix stuck sliders in Analog Filter Designer with log-mapped ranges' },
      { hash: 'a96f5af', date: '2026-02-06', changes: 'Add H(s) transfer function as design input to both filter designers' },
      { hash: '4cc55c2', date: '2026-02-06', changes: 'Rename apps and add transfer function displays' },
      { hash: '1cfce74', date: '2026-02-06', changes: 'Refactor printLabel() to use same render output as exportPNG()' },
      { hash: '6081109', date: '2026-02-06', changes: 'Fix RLC Calculator layout to match Filter Designer scrolling' },
      { hash: 'd78506e', date: '2026-02-06', changes: 'Make README.md the default opening item in project modal' },
      { hash: '84ddcde', date: '2026-02-06', changes: 'Fix label designer export/print alignment to match design canvas' },
      { hash: '389521e', date: '2026-02-06', changes: 'Add discrete biquad filter designer as new tab' },
      { hash: '615dc06', date: '2026-02-06', changes: 'Restyle RLC calculator to match main portfolio theme' },
      { hash: 'b4e75b9', date: '2026-02-06', changes: 'Add RLC Calculator as integrated app tab' },
      { hash: 'c17aeac', date: '2026-02-06', changes: 'Fix silent barcode failure on inventory import in label designer' },
      { hash: 'a1bd258', date: '2026-02-06', changes: 'Collapse nav tabs into hamburger menu on mobile/tablet' },
      { hash: 'b011a43', date: '2026-02-06', changes: 'Add TrustedParts API as 3rd search mode in datasheet tab' },
      { hash: '0e58754', date: '2026-02-06', changes: 'Encrypt NEXAR credentials with admin auth via AES-256-GCM' },
      { hash: 'df1ff64', date: '2026-02-06', changes: 'Add NEXAR API search mode to datasheet search' },
      { hash: '922db65', date: '2026-02-06', changes: 'Rename Projects tab to Original Projects' },
      { hash: 'faa501d', date: '2026-02-06', changes: 'Add datasheet search and 3D model library tabs' },
      { hash: '937938d', date: '2026-02-06', changes: 'Add camera-based resistor color band scanner' },
      { hash: '33b0e4f', date: '2026-02-06', changes: 'Add resistor color code generator as integrated app tab' },
      { hash: '12609cf', date: '2026-02-06', changes: 'Add basic shapes feature with resize support to label designer' },
      { hash: '95b0b40', date: '2026-02-06', changes: 'Remove built-in label maker from lab-inventory app' },
      { hash: '8f77bf7', date: '2026-02-06', changes: 'Move lab-inventory auth to main page admin login' },
      { hash: '944db32', date: '2026-02-06', changes: 'Add Falstad Circuit Simulator as fullscreen app tab' },
      { hash: '7b2dfb3', date: '2026-02-06', changes: 'Make Lab Inventory and Ray Optics render fullscreen' },
      { hash: '57da581', date: '2026-02-06', changes: 'Make label designer embed fullscreen, hiding chrome and padding' },
      { hash: 'ae64591', date: '2026-02-06', changes: 'Add Ray Optics simulator as an external app tab' },
      { hash: 'ddc4ff7', date: '2026-02-06', changes: 'Add Label Designer as integrated app tab in portfolio' },
      { hash: '92c8920', date: '2026-02-06', changes: 'Add code view with syntax highlighting to project modal' },
      { hash: '18c665c', date: '2026-02-06', changes: 'Collapse folder tree by default in document reader' },
      { hash: 'b977f60', date: '2026-02-06', changes: 'Replace flat file list with collapsible folder tree in doc reader' },
      { hash: '5ac6810', date: '2026-02-06', changes: 'Add about section with build info and pre-commit hook' },
      { hash: '35ebc6d', date: '2026-02-06', changes: 'Exclude pages repo from portfolio by default' },
      { hash: '609f900', date: '2026-02-05', changes: 'Add admin login interface with repo hide/unhide functionality' },
      { hash: 'dbd3440', date: '2026-02-05', changes: 'Add separate Forked Projects tab next to Projects tab' },
      { hash: '51cbdc9', date: '2026-02-05', changes: 'Add login screen to protect lab inventory access' },
      { hash: '9540075', date: '2026-02-05', changes: 'Restyle Lab Inventory to match Black Sphere Industries dark/amber theme' },
      { hash: '0b05ba1', date: '2026-02-05', changes: 'Add fork filter dropdown to portfolio page' },
      { hash: 'e42ec29', date: '2026-02-05', changes: 'Fix markdown rendering for marked.js v12+ API changes' },
      { hash: '4b3f2d6', date: '2026-02-05', changes: 'Increase MAX_REPOS to 100 to show all repositories' },
      { hash: '19bd95b', date: '2026-02-05', changes: 'Show forked repos in portfolio' },
      { hash: '56e5ccd', date: '2026-02-05', changes: 'Rename portfolio.html to index.html' },
      { hash: '6ca4718', date: '2026-02-05', changes: 'Clean up repo to keep only portfolio.html and its dependencies' },
      { hash: 'c5afde6', date: '2026-02-05', changes: 'Add pre-commit hook for auto version updates' },
      { hash: 'c2d0016', date: '2026-02-05', changes: 'Add Easy Label Maker as a new page' },
      { hash: '93f557e', date: '2026-02-01', changes: 'Add multiple CORS proxy fallbacks for image download' },
      { hash: '0416dc7', date: '2026-02-01', changes: 'Fix barcode scanner crash and add more formats' },
      { hash: '60ac2e1', date: '2026-02-01', changes: 'Add download button to sync photo from product URL' },
      { hash: '8a9899f', date: '2026-02-01', changes: 'Replace version number with git hash and build date' },
      { hash: '836a1d2', date: '2026-02-01', changes: 'Replace low stock warnings with project overallocation warnings' },
      { hash: 'bcb1994', date: '2026-02-01', changes: 'Add automatic version check with update banner' },
      { hash: 'd8c5138', date: '2026-02-01', changes: 'Update scanner for CODE128 barcode support' },
      { hash: '36239b4', date: '2026-02-01', changes: 'Add sync photos from product links feature' },
      { hash: 'e05aecb', date: '2026-02-01', changes: 'Add nested menus for Locaties view' },
      { hash: 'cad748c', date: '2026-02-01', changes: 'Switch from QR codes to CODE128 barcodes for label printing' },
      { hash: 'e4b1be2', date: '2026-02-01', changes: 'Update lab map to show dynamic locations from Locaties tab' },
      { hash: 'a6a5da5', date: '2026-02-01', changes: 'Add Locaties (shelves/drawers) view with collapsible boxes' },
      { hash: '1111e41', date: '2026-02-01', changes: 'Add interactive lab map view' },
      { hash: 'ed50ea1', date: '2026-02-01', changes: 'Add value field and projects/BoM system' },
      { hash: '87894e7', date: '2026-02-01', changes: 'Add dark mode theme and Material Design icons' },
      { hash: 'cd05eca', date: '2026-02-01', changes: 'Add OWASP security improvements' },
      { hash: '55c2a76', date: '2026-02-01', changes: 'Add ZIP export/import with photos' },
      { hash: '66390e9', date: '2026-02-01', changes: 'Add Philips 12NC identification codes to items' },
      { hash: '0258d02', date: '2026-02-01', changes: 'Add IndexedDB storage with photo support' },
      { hash: '7ca5282', date: '2026-02-01', changes: 'Add QR code printing functionality via CUPS' },
      { hash: '9393842', date: '2026-01-31', changes: 'Change box click to navigate to Items tab with filter' },
      { hash: '27c6221', date: '2026-01-31', changes: 'Initial upload' },
    ];
    // ============================================

    // Lucide icons
    const icons = lucide;

    // Icon component helper
    const Icon = ({ name, size = 20, className = '' }) => {
      const ref = React.useRef(null);
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = icons.createElement(icons[name]);
          icon.setAttribute('width', size);
          icon.setAttribute('height', size);
          if (className) icon.setAttribute('class', className);
          ref.current.appendChild(icon);
        }
      }, [name, size, className]);
      return <span ref={ref} className="inline-flex" />;
    };

    // Language colors
    const languageColors = {
      JavaScript: '#f7df1e', TypeScript: '#3178c6', Python: '#3572A5',
      Rust: '#dea584', Go: '#00ADD8', C: '#555555', 'C++': '#f34b7d',
      Java: '#b07219', Ruby: '#701516', PHP: '#4F5D95', Swift: '#ffac45',
      Kotlin: '#A97BFF', HTML: '#e34c26', CSS: '#563d7c', Shell: '#89e051',
      Dockerfile: '#384d54', Vue: '#41b883', Svelte: '#ff3e00',
    };

    // Time ago helper
    const getTimeAgo = (date) => {
      const seconds = Math.floor((new Date() - new Date(date)) / 1000);
      const intervals = [
        { label: 'year', seconds: 31536000 },
        { label: 'month', seconds: 2592000 },
        { label: 'week', seconds: 604800 },
        { label: 'day', seconds: 86400 },
        { label: 'hour', seconds: 3600 },
      ];
      for (const interval of intervals) {
        const count = Math.floor(seconds / interval.seconds);
        if (count >= 1) return `${count} ${interval.label}${count > 1 ? 's' : ''} ago`;
      }
      return 'just now';
    };

    // Configure marked.js with highlight.js
    const configureMarked = () => {
      // Custom renderer for styled output
      const renderer = new marked.Renderer();

      // Add language label and copy button to code blocks
      // Supports both old marked API (positional args) and new marked v12+ API (token object)
      renderer.code = (codeOrToken, language) => {
        const code = typeof codeOrToken === 'object' ? (codeOrToken.text || '') : codeOrToken;
        const lang = typeof codeOrToken === 'object' ? codeOrToken.lang : language;
        const validLang = lang && hljs.getLanguage(lang) ? lang : 'plaintext';
        const highlighted = hljs.highlight(code, { language: validLang, ignoreIllegals: true }).value;
        const langLabel = lang || 'code';
        const escapedCode = code.replace(/'/g, "\\'").replace(/\n/g, '\\n');
        return `
          <div class="code-block-wrapper">
            <div class="code-block-header">
              <span>${langLabel}</span>
              <button class="copy-btn" onclick="navigator.clipboard.writeText('${escapedCode}').then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 2000); })">Copy</button>
            </div>
            <pre><code class="hljs language-${validLang}">${highlighted}</code></pre>
          </div>
        `;
      };

      // Make links open in new tab
      renderer.link = (hrefOrToken, title, text) => {
        const h = typeof hrefOrToken === 'object' ? (hrefOrToken.href || '') : hrefOrToken;
        const t = typeof hrefOrToken === 'object' ? hrefOrToken.title : title;
        const txt = typeof hrefOrToken === 'object' ? hrefOrToken.text : text;
        const titleAttr = t ? ` title="${t}"` : '';
        return `<a href="${h}"${titleAttr} target="_blank" rel="noopener noreferrer">${txt}</a>`;
      };

      // Handle checkboxes in task lists
      renderer.listitem = (textOrToken, task, checked) => {
        const txt = typeof textOrToken === 'object' ? textOrToken.text : textOrToken;
        const isTask = typeof textOrToken === 'object' ? textOrToken.task : task;
        const isChecked = typeof textOrToken === 'object' ? textOrToken.checked : checked;
        if (isTask) {
          return `<li class="task-list-item"><input type="checkbox" ${isChecked ? 'checked' : ''} disabled> ${txt}</li>`;
        }
        return `<li>${txt}</li>`;
      };

      marked.setOptions({
        renderer,
        gfm: true,
        breaks: true,
        headerIds: true,
        mangle: false,
      });
    };

    // Initialize marked configuration
    configureMarked();

    // GitHub emoji support
    let emojiMap = {};
    fetch('https://api.github.com/emojis')
      .then(r => r.ok ? r.json() : {})
      .then(data => { emojiMap = data; })
      .catch(() => {});

    const replaceEmojis = (text) =>
      text.replace(/:([a-z0-9_+\-]+):/g, (match, name) => {
        const url = emojiMap[name];
        if (!url) return match;
        return `<img src="${url}" alt="${name}" class="inline-emoji" />`;
      });

    // Markdown renderer using marked.js
    const renderMarkdown = (text) => {
      if (!text) return '';
      try {
        const html = marked.parse(text);
        return replaceEmojis(html);
      } catch (e) {
        console.error('Markdown parsing error:', e);
        return `<pre>${text}</pre>`;
      }
    };

    // Project Card
    const ProjectCard = ({ repo, onClick, isAdmin, isHidden, onToggleHide }) => {
      const langColor = languageColors[repo.language] || '#6b7280';

      return (
        <div onClick={onClick}
             className={`group relative bg-zinc-900 border rounded-lg p-5 cursor-pointer
                        hover:border-amber-500/50 hover:bg-zinc-800/80 transition-all duration-300
                        hover:shadow-lg hover:shadow-amber-500/10 hover:-translate-y-1
                        ${isHidden ? 'border-red-500/30 opacity-60' : 'border-zinc-700'}`}>
          {/* Terminal header */}
          <div className="flex items-center gap-2 mb-3 pb-2 border-b border-zinc-700">
            <div className="flex gap-1.5">
              <div className="w-3 h-3 rounded-full bg-red-500/80"></div>
              <div className="w-3 h-3 rounded-full bg-yellow-500/80"></div>
              <div className="w-3 h-3 rounded-full bg-green-500/80"></div>
            </div>
            <span className="text-zinc-500 font-mono text-xs ml-2 truncate flex-1">~/projects/{repo.name}</span>
            {isAdmin && (
              <button onClick={(e) => { e.stopPropagation(); onToggleHide(repo.name); }}
                      title={isHidden ? 'Unhide repo' : 'Hide repo'}
                      className={`p-1 rounded transition-colors z-10 ${isHidden
                        ? 'text-red-400 hover:bg-red-500/20 hover:text-red-300'
                        : 'text-zinc-600 hover:bg-zinc-700 hover:text-zinc-300'}`}>
                <Icon name={isHidden ? 'EyeOff' : 'Eye'} size={14} />
              </button>
            )}
          </div>

          <div className="flex items-center gap-2 mb-2">
            <h3 className="text-xl font-mono font-bold text-zinc-100 group-hover:text-amber-400 transition-colors truncate">
              {repo.name}
            </h3>
            {isHidden && (
              <span className="text-xs bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded font-mono shrink-0">hidden</span>
            )}
          </div>

          <p className="text-zinc-400 text-sm mb-4 line-clamp-2 min-h-[40px]">
            {repo.description || 'No description provided'}
          </p>

          {/* Topics */}
          {repo.topics && repo.topics.length > 0 && (
            <div className="flex flex-wrap gap-1.5 mb-3">
              {repo.topics.slice(0, 3).map(topic => (
                <span key={topic} className="text-xs px-2 py-0.5 bg-amber-500/10 text-amber-400 rounded font-mono">
                  {topic}
                </span>
              ))}
              {repo.topics.length > 3 && (
                <span className="text-xs text-zinc-500">+{repo.topics.length - 3}</span>
              )}
            </div>
          )}

          {/* Stats */}
          <div className="flex items-center gap-4 text-xs text-zinc-500">
            {repo.language && (
              <div className="flex items-center gap-1.5">
                <span className="w-3 h-3 rounded-full" style={{ backgroundColor: langColor }}></span>
                <span>{repo.language}</span>
              </div>
            )}
            <div className="flex items-center gap-1">
              <Icon name="Star" size={14} className="text-amber-500" />
              <span>{repo.stargazers_count}</span>
            </div>
            <div className="flex items-center gap-1">
              <Icon name="GitFork" size={14} />
              <span>{repo.forks_count}</span>
            </div>
          </div>

          <div className="flex items-center gap-1 text-xs text-zinc-600 mt-3">
            <Icon name="Clock" size={12} />
            <span>Updated {getTimeAgo(repo.updated_at)}</span>
          </div>

          <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-amber-500 to-orange-500
                          scale-x-0 group-hover:scale-x-100 transition-transform duration-300 rounded-b-lg"></div>
        </div>
      );
    };

    // Documentation Reader Modal
    const ProjectModal = ({ repo, username, onClose }) => {
      const [docs, setDocs] = useState([]);
      const [selectedDoc, setSelectedDoc] = useState(null);
      const [content, setContent] = useState('');
      const [loading, setLoading] = useState(true);
      const [docsLoading, setDocsLoading] = useState(true);
      const [sidebarOpen, setSidebarOpen] = useState(true);
      const [expandedFolders, setExpandedFolders] = useState({});
      const [viewMode, setViewMode] = useState('docs'); // 'docs' or 'code'
      const [codeFiles, setCodeFiles] = useState([]);
      const [codeLoading, setCodeLoading] = useState(false);
      const [selectedCodeFile, setSelectedCodeFile] = useState(null);
      const [codeContent, setCodeContent] = useState('');
      const [codeContentLoading, setCodeContentLoading] = useState(false);
      const [isFullscreen, setIsFullscreen] = useState(false);
      const [fileSearch, setFileSearch] = useState('');

      const toggleFolder = (folderPath) => {
        setExpandedFolders(prev => ({ ...prev, [folderPath]: !prev[folderPath] }));
      };

      // Build a nested tree from flat file paths
      const buildTree = (paths) => {
        const root = { name: '', children: {}, files: [] };
        paths.forEach(path => {
          const parts = path.split('/');
          let current = root;
          for (let i = 0; i < parts.length - 1; i++) {
            const folderName = parts[i];
            if (!current.children[folderName]) {
              current.children[folderName] = { name: folderName, children: {}, files: [] };
            }
            current = current.children[folderName];
          }
          current.files.push({ name: parts[parts.length - 1], path });
        });
        return root;
      };

      // Get language from file extension for syntax highlighting
      const getLangFromPath = (path) => {
        const ext = path.split('.').pop().toLowerCase();
        const map = {
          js: 'javascript', jsx: 'javascript', ts: 'typescript', tsx: 'typescript',
          py: 'python', rb: 'ruby', rs: 'rust', go: 'go', java: 'java',
          c: 'c', h: 'c', cpp: 'cpp', hpp: 'cpp', cs: 'csharp',
          html: 'xml', htm: 'xml', xml: 'xml', svg: 'xml',
          css: 'css', scss: 'scss', less: 'less',
          json: 'json', yaml: 'yaml', yml: 'yaml', toml: 'ini',
          md: 'markdown', sh: 'bash', bash: 'bash', zsh: 'bash',
          sql: 'sql', php: 'php', swift: 'swift', kt: 'kotlin',
          dockerfile: 'dockerfile', makefile: 'makefile',
          lua: 'lua', r: 'r', dart: 'dart', vue: 'xml', svelte: 'xml',
        };
        return map[ext] || 'plaintext';
      };

      // Fetch list of markdown files in the repo
      useEffect(() => {
        const fetchDocs = async () => {
          setDocsLoading(true);
          try {
            const response = await fetch(
              `https://api.github.com/repos/${username}/${repo.name}/git/trees/HEAD?recursive=1`
            );
            if (response.ok) {
              const data = await response.json();
              const allBlobs = data.tree.filter(f => f.type === 'blob');
              const mdFiles = allBlobs
                .filter(f => /\.(md|markdown)$/i.test(f.path))
                .map(f => f.path)
                .sort((a, b) => {
                  if (a.toLowerCase().includes('readme')) return -1;
                  if (b.toLowerCase().includes('readme')) return 1;
                  return a.localeCompare(b);
                });
              setDocs(mdFiles.length > 0 ? mdFiles : ['README.md']);
              // Default to first README (sorted first), or fallback to README.md
              setSelectedDoc(mdFiles.length > 0 ? mdFiles[0] : 'README.md');
              // Store all code files (non-markdown blobs)
              const allCodeFiles = allBlobs
                .filter(f => !/\.(md|markdown)$/i.test(f.path))
                .map(f => f.path)
                .sort();
              setCodeFiles(allCodeFiles);
            } else {
              setDocs(['README.md']);
            }
          } catch {
            setDocs(['README.md']);
          } finally {
            setDocsLoading(false);
          }
        };
        fetchDocs();
      }, [repo.name, username]);

      // Fetch selected document content
      useEffect(() => {
        if (viewMode !== 'docs') return;
        const fetchContent = async () => {
          setLoading(true);
          try {
            const response = await fetch(
              `https://api.github.com/repos/${username}/${repo.name}/contents/${selectedDoc}`
            );
            if (response.ok) {
              const data = await response.json();
              setContent(atob(data.content));
            } else {
              setContent('');
            }
          } catch {
            setContent('');
          } finally {
            setLoading(false);
          }
        };
        if (selectedDoc) fetchContent();
      }, [selectedDoc, repo.name, username, viewMode]);

      // Fetch selected code file content
      useEffect(() => {
        if (viewMode !== 'code' || !selectedCodeFile) return;
        const fetchCode = async () => {
          setCodeContentLoading(true);
          try {
            const response = await fetch(
              `https://api.github.com/repos/${username}/${repo.name}/contents/${selectedCodeFile}`
            );
            if (response.ok) {
              const data = await response.json();
              setCodeContent(atob(data.content));
            } else {
              setCodeContent('');
            }
          } catch {
            setCodeContent('');
          } finally {
            setCodeContentLoading(false);
          }
        };
        fetchCode();
      }, [selectedCodeFile, repo.name, username, viewMode]);

      useEffect(() => {
        const handleEsc = (e) => e.key === 'Escape' && onClose();
        window.addEventListener('keydown', handleEsc);
        document.body.style.overflow = 'hidden';
        return () => {
          window.removeEventListener('keydown', handleEsc);
          document.body.style.overflow = '';
        };
      }, [onClose]);

      const getFileName = (path) => path.split('/').pop();

      // Glob-style wildcard match: * = segment chars, ** = any path, ? = single char
      const globMatch = (pattern, path) => {
        const regexStr = pattern
          .replace(/[.+^${}()|[\]\\]/g, '\\$&')
          .replace(/\*\*/g, '\0')
          .replace(/\*/g, '[^/]*')
          .replace(/\0/g, '.*')
          .replace(/\?/g, '.');
        return new RegExp(regexStr, 'i').test(path);
      };

      const allFiles = viewMode === 'docs' ? docs : codeFiles;
      const currentFiles = useMemo(() => {
        if (!fileSearch.trim()) return allFiles;
        const q = fileSearch.trim();
        // If query contains wildcard chars, use glob matching; otherwise substring match
        if (/[*?]/.test(q)) {
          return allFiles.filter(f => globMatch(q, f));
        }
        const lower = q.toLowerCase();
        return allFiles.filter(f => f.toLowerCase().includes(lower));
      }, [allFiles, fileSearch]);
      const currentSelected = viewMode === 'docs' ? selectedDoc : selectedCodeFile;
      const setCurrentSelected = viewMode === 'docs' ? setSelectedDoc : setSelectedCodeFile;
      const isTreeLoading = viewMode === 'docs' ? docsLoading : docsLoading; // both come from same fetch

      // Render highlighted code
      const renderCodeContent = (code, filePath) => {
        const lang = getLangFromPath(filePath);
        const validLang = hljs.getLanguage(lang) ? lang : 'plaintext';
        try {
          return hljs.highlight(code, { language: validLang, ignoreIllegals: true }).value;
        } catch {
          return code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
      };

      // Render tree nodes (shared between docs and code views)
      const renderTree = () => {
        const tree = buildTree(currentFiles);
        const isSearching = fileSearch.trim().length > 0;
        const renderNode = (node, path, depth) => {
          const folderEntries = Object.keys(node.children).sort();
          const pl = `${0.75 + depth * 0.75}rem`;
          return (
            <React.Fragment key={path || 'root'}>
              {folderEntries.map(name => {
                const folderPath = path ? `${path}/${name}` : name;
                const isExpanded = isSearching || expandedFolders[folderPath];
                return (
                  <React.Fragment key={folderPath}>
                    <button onClick={() => toggleFolder(folderPath)}
                            className="w-full text-left py-1.5 text-sm font-mono transition-colors flex items-center gap-1.5
                                     text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200"
                            style={{ paddingLeft: pl }}>
                      <Icon name={isExpanded ? 'ChevronDown' : 'ChevronRight'} size={12} className="text-zinc-600 shrink-0" />
                      <Icon name={isExpanded ? 'FolderOpen' : 'Folder'} size={14} className="text-amber-500/70 shrink-0" />
                      <span className="truncate">{name}</span>
                    </button>
                    {isExpanded && renderNode(node.children[name], folderPath, depth + 1)}
                  </React.Fragment>
                );
              })}
              {node.files.map(file => (
                <button key={file.path}
                        onClick={() => setCurrentSelected(file.path)}
                        className={`w-full text-left py-1.5 text-sm font-mono transition-colors flex items-center gap-1.5
                                  ${currentSelected === file.path
                                    ? 'bg-amber-500/20 text-amber-400 border-r-2 border-amber-500'
                                    : 'text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200'}`}
                        style={{ paddingLeft: `${0.75 + (depth + 0.5) * 0.75}rem` }}>
                  <Icon name={viewMode === 'code' ? 'FileCode' : 'FileText'} size={14}
                        className={currentSelected === file.path ? 'text-amber-500 shrink-0' : 'text-zinc-600 shrink-0'} />
                  <span className="truncate">{file.name}</span>
                </button>
              ))}
            </React.Fragment>
          );
        };
        return <div className="py-1">{renderNode(tree, '', 0)}</div>;
      };

      const displayedPath = viewMode === 'docs' ? (selectedDoc || '') : (selectedCodeFile || '');

      return (
        <div className={`fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center ${isFullscreen ? 'p-0' : 'p-2 sm:p-4'}`}
             onClick={onClose}>
          <div className={`bg-zinc-900 border border-zinc-700 overflow-hidden shadow-2xl flex flex-col ${
            isFullscreen ? 'w-full h-full rounded-none' : 'w-full max-w-6xl h-[95vh] rounded-xl'
          }`} onClick={e => e.stopPropagation()}>
            {/* Header */}
            <div className="bg-zinc-800 border-b border-zinc-700 p-3 flex items-center justify-between shrink-0">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:bg-red-400" onClick={onClose}></div>
                  <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <button onClick={() => setSidebarOpen(!sidebarOpen)}
                        className="p-1 hover:bg-zinc-700 rounded transition-colors lg:hidden">
                  <Icon name={sidebarOpen ? 'PanelLeftClose' : 'PanelLeft'} size={16} className="text-zinc-400" />
                </button>
                <div className="flex items-center gap-2">
                  <Icon name={viewMode === 'docs' ? 'BookOpen' : 'Code'} size={18} className="text-amber-500" />
                  <span className="font-mono text-zinc-200 font-bold">{repo.name}</span>
                  {displayedPath && (
                    <span className="text-zinc-500 font-mono text-sm hidden sm:inline">/ {displayedPath}</span>
                  )}
                </div>
              </div>
              <div className="flex items-center gap-2">
                {/* View mode toggle */}
                <div className="flex bg-zinc-700/50 rounded-lg p-0.5">
                  <button onClick={() => { setViewMode('docs'); setFileSearch(''); }}
                          className={`flex items-center gap-1.5 px-2.5 py-1 rounded-md font-mono text-xs transition-all
                                    ${viewMode === 'docs' ? 'bg-amber-500 text-zinc-900' : 'text-zinc-400 hover:text-zinc-200'}`}>
                    <Icon name="BookOpen" size={12} />
                    <span className="hidden sm:inline">Docs</span>
                  </button>
                  <button onClick={() => { setViewMode('code'); setFileSearch(''); }}
                          className={`flex items-center gap-1.5 px-2.5 py-1 rounded-md font-mono text-xs transition-all
                                    ${viewMode === 'code' ? 'bg-amber-500 text-zinc-900' : 'text-zinc-400 hover:text-zinc-200'}`}>
                    <Icon name="Code" size={12} />
                    <span className="hidden sm:inline">Code</span>
                  </button>
                </div>
                <a href={`${repo.html_url}/blob/HEAD/${displayedPath}`} target="_blank" rel="noopener noreferrer"
                   className="flex items-center gap-1.5 text-zinc-400 hover:text-amber-400 transition-colors text-sm px-2 py-1 rounded hover:bg-zinc-700">
                  <Icon name="Github" size={14} />
                  <span className="hidden sm:inline">View on GitHub</span>
                </a>
                <button onClick={() => setIsFullscreen(!isFullscreen)} title={isFullscreen ? 'Exit fullscreen' : 'Fullscreen'}
                        className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded transition-colors">
                  <Icon name={isFullscreen ? 'Minimize2' : 'Maximize2'} size={16} />
                </button>
                <button onClick={onClose} className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded">
                  <Icon name="X" size={20} />
                </button>
              </div>
            </div>

            {/* Main content area */}
            <div className="flex flex-1 overflow-hidden">
              {/* Sidebar - File tree */}
              <div className={`${sidebarOpen ? 'w-64' : 'w-0'} shrink-0 bg-zinc-850 border-r border-zinc-700 overflow-hidden transition-all duration-200`}
                   style={{ backgroundColor: '#1a1a1f' }}>
                <div className="p-3 border-b border-zinc-700 space-y-2">
                  <h3 className="text-xs font-mono text-zinc-500 uppercase tracking-wider flex items-center gap-2">
                    <Icon name={viewMode === 'docs' ? 'Files' : 'FolderCode'} size={14} />
                    {viewMode === 'docs' ? 'Documentation' : 'Source Code'}
                  </h3>
                  <div className="relative">
                    <Icon name="Search" size={12} className="absolute left-2 top-1/2 -translate-y-1/2 text-zinc-600" />
                    <input type="text" value={fileSearch} onChange={e => setFileSearch(e.target.value)}
                           placeholder="Filter files... (* = wildcard)"
                           className="w-full bg-zinc-800 border border-zinc-700 rounded pl-7 pr-7 py-1 font-mono text-xs
                                    text-zinc-300 placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none" />
                    {fileSearch && (
                      <button onClick={() => setFileSearch('')}
                              className="absolute right-1.5 top-1/2 -translate-y-1/2 text-zinc-600 hover:text-zinc-400">
                        <Icon name="X" size={12} />
                      </button>
                    )}
                  </div>
                </div>
                <div className="px-2 py-2 border-b border-zinc-700">
                  <div className="relative">
                    <Icon name="Search" size={13} className="absolute left-2 top-1/2 -translate-y-1/2 text-zinc-600" />
                    <input type="text" value={fileSearch} onChange={e => setFileSearch(e.target.value)}
                           placeholder="Search files... (*.js, src/**)"
                           className="w-full bg-zinc-800 border border-zinc-700 rounded-md pl-7 pr-7 py-1.5 text-xs font-mono text-zinc-300
                                    placeholder-zinc-600 focus:outline-none focus:border-amber-500/50 focus:ring-1 focus:ring-amber-500/20" />
                    {fileSearch && (
                      <button onClick={() => setFileSearch('')}
                              className="absolute right-1.5 top-1/2 -translate-y-1/2 text-zinc-600 hover:text-zinc-300 p-0.5">
                        <Icon name="X" size={12} />
                      </button>
                    )}
                  </div>
                </div>
                <div className="overflow-y-auto h-[calc(100%-96px)]">
                  {isTreeLoading ? (
                    <div className="p-4 text-center">
                      <div className="animate-spin rounded-full h-5 w-5 border-t-2 border-amber-500 mx-auto"></div>
                    </div>
                  ) : currentFiles.length === 0 ? (
                    <div className="p-4 text-center text-zinc-600 font-mono text-xs">
                      {fileSearch ? 'No matches' : 'No files found'}
                    </div>
                  ) : renderTree()}
                </div>
              </div>

              {/* Content area */}
              <div className="flex-1 overflow-y-auto">
                {/* Stats bar */}
                <div className="bg-zinc-800/30 border-b border-zinc-700/50 px-4 py-2 flex flex-wrap gap-4 text-xs shrink-0">
                  <div className="flex items-center gap-1.5">
                    <Icon name="Star" size={14} className="text-amber-500" />
                    <span className="text-zinc-400">{repo.stargazers_count}</span>
                  </div>
                  <div className="flex items-center gap-1.5">
                    <Icon name="GitFork" size={14} className="text-zinc-500" />
                    <span className="text-zinc-400">{repo.forks_count}</span>
                  </div>
                  {repo.language && (
                    <div className="flex items-center gap-1.5">
                      <span className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: languageColors[repo.language] || '#6b7280' }}></span>
                      <span className="text-zinc-400">{repo.language}</span>
                    </div>
                  )}
                  {repo.license && (
                    <div className="flex items-center gap-1.5">
                      <Icon name="Scale" size={14} className="text-zinc-500" />
                      <span className="text-zinc-400">{repo.license.spdx_id || repo.license.name}</span>
                    </div>
                  )}
                  {repo.description && (
                    <div className="flex-1 text-zinc-500 truncate hidden md:block">
                      {repo.description}
                    </div>
                  )}
                </div>

                {/* Content */}
                {viewMode === 'docs' ? (
                  <div className="p-6 md:p-8">
                    {loading || !selectedDoc ? (
                      <div className="flex items-center justify-center py-12">
                        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-amber-500"></div>
                        <span className="ml-3 text-zinc-400 font-mono">Loading {selectedDoc ? getFileName(selectedDoc) : 'README'}...</span>
                      </div>
                    ) : content ? (
                      <div className="markdown-body max-w-none"
                           dangerouslySetInnerHTML={{ __html: renderMarkdown(content) }} />
                    ) : (
                      <div className="text-center py-12 text-zinc-500">
                        <Icon name="FileQuestion" size={48} className="mx-auto mb-4 opacity-50" />
                        <p className="font-mono">Document not found: {selectedDoc}</p>
                        <p className="text-sm mt-2">This file may not exist in the repository.</p>
                      </div>
                    )}
                  </div>
                ) : (
                  <div className="p-0">
                    {!selectedCodeFile ? (
                      <div className="text-center py-12 text-zinc-500">
                        <Icon name="FileCode" size={48} className="mx-auto mb-4 opacity-50" />
                        <p className="font-mono">Select a file to view</p>
                      </div>
                    ) : codeContentLoading ? (
                      <div className="flex items-center justify-center py-12">
                        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-amber-500"></div>
                        <span className="ml-3 text-zinc-400 font-mono">Loading {getFileName(selectedCodeFile)}...</span>
                      </div>
                    ) : codeContent ? (
                      <div className="relative">
                        <div className="bg-zinc-800/50 border-b border-zinc-700/50 px-4 py-1.5 flex items-center justify-between">
                          <span className="font-mono text-xs text-zinc-500">{selectedCodeFile}</span>
                          <button onClick={() => { navigator.clipboard.writeText(codeContent); }}
                                  className="text-xs text-zinc-500 hover:text-zinc-300 font-mono px-2 py-0.5 rounded hover:bg-zinc-700 transition-colors">
                            Copy
                          </button>
                        </div>
                        <pre className="p-4 overflow-x-auto text-sm leading-relaxed"><code
                          className={`hljs language-${getLangFromPath(selectedCodeFile)}`}
                          dangerouslySetInnerHTML={{ __html: renderCodeContent(codeContent, selectedCodeFile) }}
                        /></pre>
                      </div>
                    ) : (
                      <div className="text-center py-12 text-zinc-500">
                        <Icon name="FileQuestion" size={48} className="mx-auto mb-4 opacity-50" />
                        <p className="font-mono">File not found: {selectedCodeFile}</p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Navigation Tab Button (icon-only with tooltip)
    const NavTab = ({ active, icon, label, onClick }) => (
      <button onClick={onClick} title={label}
              className={`relative group flex items-center justify-center w-9 h-9 rounded-lg transition-all
                        ${active
                          ? 'bg-amber-500 text-zinc-900 shadow-lg shadow-amber-500/20'
                          : 'bg-zinc-800/60 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200'}`}>
        <Icon name={icon} size={16} />
        <span className="pointer-events-none absolute -bottom-8 left-1/2 -translate-x-1/2 px-2 py-1 rounded bg-zinc-800
                         border border-zinc-700 text-xs font-mono text-zinc-300 whitespace-nowrap opacity-0
                         group-hover:opacity-100 transition-opacity z-50 shadow-lg">{label}</span>
      </button>
    );

    // Discipline dropdown navigation - groups apps by engineering discipline
    const DisciplineNav = ({ activeView, onSelectApp, visibleApps }) => {
      const [openId, setOpenId] = useState(null);
      const navRef = React.useRef(null);

      // Close dropdown on click outside
      useEffect(() => {
        if (!openId) return;
        const handleClick = (e) => {
          if (navRef.current && !navRef.current.contains(e.target)) setOpenId(null);
        };
        document.addEventListener('mousedown', handleClick);
        return () => document.removeEventListener('mousedown', handleClick);
      }, [openId]);

      // Group visible apps by discipline
      const grouped = useMemo(() => {
        const g = {};
        visibleApps.forEach(app => {
          const d = app.discipline || 'other';
          if (!g[d]) g[d] = [];
          g[d].push(app);
        });
        return g;
      }, [visibleApps]);

      return (
        <div ref={navRef} className="flex items-center gap-1">
          {CONFIG.DISCIPLINES.filter(d => grouped[d.id]?.length > 0).map(disc => {
            const discApps = grouped[disc.id];
            const isActive = discApps.some(a => a.id === activeView);
            const isOpen = openId === disc.id;

            return (
              <div key={disc.id} className="relative">
                <button onClick={() => setOpenId(isOpen ? null : disc.id)}
                        className={`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg font-mono text-xs font-medium transition-all
                                  ${isActive
                                    ? 'bg-amber-500 text-zinc-900 shadow-lg shadow-amber-500/20'
                                    : 'bg-zinc-800/60 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200'}`}>
                  <Icon name={disc.icon} size={14} />
                  <span className="hidden md:inline">{disc.name}</span>
                  <Icon name="ChevronDown" size={10}
                        className={`transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />
                </button>

                {isOpen && (
                  <div className="absolute top-full left-0 mt-1.5 bg-zinc-900 border border-zinc-700 rounded-lg
                                  shadow-2xl shadow-black/50 z-50 min-w-[220px] py-1 overflow-hidden">
                    <div className="px-3 py-1.5 border-b border-zinc-800">
                      <span className="font-mono text-[10px] uppercase tracking-widest text-zinc-600">{disc.name}</span>
                    </div>
                    {discApps.map(app => (
                      <button key={app.id}
                              onClick={() => { onSelectApp(app.id); setOpenId(null); }}
                              className={`w-full flex items-center gap-2.5 px-3 py-2 text-left transition-colors
                                        ${activeView === app.id
                                          ? 'bg-amber-500/15 text-amber-400'
                                          : 'text-zinc-300 hover:bg-zinc-800 hover:text-zinc-100'}`}>
                        <Icon name={app.icon} size={16}
                              className={activeView === app.id ? 'text-amber-500' : 'text-zinc-500'} />
                        <span className="font-mono text-xs">{app.name}</span>
                      </button>
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      );
    };

    // Login Modal — SSO with Firebase Auth + password fallback
    const LoginModal = ({ onLogin, onClose }) => {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);
      const [showPassword, setShowPassword] = useState(false);

      const handlePasswordSubmit = (e) => {
        e.preventDefault();
        if (password === CONFIG.ADMIN_PASSWORD) {
          onLogin({ method: 'password' });
        } else {
          setError('Invalid password');
          setPassword('');
        }
      };

      const handleSSO = async (providerName) => {
        setError('');
        setLoading(true);
        try {
          const provider = googleProvider;
          const result = await auth.signInWithPopup(provider);
          const user = result.user;
          const isEmailAdmin = CONFIG.ADMIN_EMAILS.length > 0
            ? CONFIG.ADMIN_EMAILS.includes(user.email)
            : true; // If no admin emails configured, all SSO users get admin
          onLogin({
            method: 'sso',
            provider: providerName,
            user: {
              uid: user.uid,
              email: user.email,
              displayName: user.displayName,
              photoURL: user.photoURL,
            },
            isAdmin: isEmailAdmin,
          });
        } catch (err) {
          if (err.code === 'auth/popup-closed-by-user') {
            setError('Sign-in cancelled');
          } else if (err.code === 'auth/account-exists-with-different-credential') {
            setError('Account exists with a different sign-in method');
          } else {
            setError(err.message || 'Sign-in failed');
          }
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        const handleEsc = (e) => e.key === 'Escape' && onClose();
        window.addEventListener('keydown', handleEsc);
        return () => window.removeEventListener('keydown', handleEsc);
      }, [onClose]);

      const providerMeta = {
        google: { name: 'Google', icon: 'Chrome', color: 'bg-blue-600 hover:bg-blue-500' },
      };

      return (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4"
             onClick={onClose}>
          <div className="bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-sm shadow-2xl"
               onClick={e => e.stopPropagation()}>
            <div className="bg-zinc-800 border-b border-zinc-700 p-3 flex items-center justify-between rounded-t-xl">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:bg-red-400" onClick={onClose}></div>
                  <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div className="flex items-center gap-2">
                  <Icon name="Lock" size={16} className="text-amber-500" />
                  <span className="font-mono text-zinc-200 text-sm font-bold">Sign In</span>
                </div>
              </div>
              <button onClick={onClose} className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded">
                <Icon name="X" size={18} />
              </button>
            </div>
            <div className="p-6">
              {/* SSO Buttons */}
              {CONFIG.SSO_PROVIDERS.length > 0 && (
                <div className="space-y-2.5 mb-5">
                  <label className="block font-mono text-xs text-zinc-500 mb-2">
                    <span className="text-green-400">$</span> sign in with
                  </label>
                  {CONFIG.SSO_PROVIDERS.map(p => {
                    const meta = providerMeta[p];
                    if (!meta) return null;
                    return (
                      <button key={p} onClick={() => handleSSO(p)} disabled={loading}
                              className={`w-full flex items-center justify-center gap-2.5 ${meta.color} text-white font-mono font-bold text-sm
                                         py-2.5 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed`}>
                        {loading ? (
                          <div className="animate-spin rounded-full h-4 w-4 border-t-2 border-white"></div>
                        ) : (
                          <Icon name={meta.icon} size={18} />
                        )}
                        Continue with {meta.name}
                      </button>
                    );
                  })}
                </div>
              )}

              {/* Divider */}
              {CONFIG.SSO_PROVIDERS.length > 0 && (
                <div className="flex items-center gap-3 mb-5">
                  <div className="flex-1 border-t border-zinc-700"></div>
                  <span className="font-mono text-xs text-zinc-600">or</span>
                  <div className="flex-1 border-t border-zinc-700"></div>
                </div>
              )}

              {/* Password fallback */}
              {!showPassword && CONFIG.SSO_PROVIDERS.length > 0 ? (
                <button onClick={() => setShowPassword(true)}
                        className="w-full text-center font-mono text-xs text-zinc-500 hover:text-zinc-300 transition-colors py-2">
                  Use admin password instead
                </button>
              ) : (
                <form onSubmit={handlePasswordSubmit}>
                  <label className="block font-mono text-xs text-zinc-500 mb-2">
                    <span className="text-green-400">$</span> enter password
                  </label>
                  <input type="password" value={password} onChange={(e) => { setPassword(e.target.value); setError(''); }}
                         autoFocus placeholder="••••••••"
                         className="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 font-mono text-sm
                                  placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none mb-3" />
                  <button type="submit"
                          className="w-full bg-amber-500 hover:bg-amber-400 text-zinc-900 font-mono font-bold text-sm
                                   py-2.5 rounded-lg transition-colors">
                    Authenticate
                  </button>
                </form>
              )}

              {/* Error display */}
              {error && (
                <p className="text-red-400 text-xs font-mono mt-3">
                  <span className="text-red-500">error:</span> {error}
                </p>
              )}
            </div>
          </div>
        </div>
      );
    };

    // Feedback Modal
    const FeedbackModal = ({ onClose }) => {
      const [feedbackType, setFeedbackType] = useState('bug');
      const [subject, setSubject] = useState('');
      const [description, setDescription] = useState('');
      const [sending, setSending] = useState(false);
      const [sent, setSent] = useState(false);

      const templates = {
        bug: {
          label: 'Report a Problem',
          icon: 'Bug',
          subjectPlaceholder: 'Brief summary of the issue',
          descriptionPlaceholder: 'What happened?\n\nSteps to reproduce:\n1. \n2. \n3. \n\nExpected behavior:\n\nActual behavior:',
        },
        feature: {
          label: 'Suggest a Feature',
          icon: 'Lightbulb',
          subjectPlaceholder: 'Feature title',
          descriptionPlaceholder: 'Describe the feature you\'d like to see:\n\nWhy would this be useful?\n\nAny additional context:',
        },
      };
      const t = templates[feedbackType];

      useEffect(() => {
        const handleEsc = (e) => e.key === 'Escape' && onClose();
        window.addEventListener('keydown', handleEsc);
        return () => window.removeEventListener('keydown', handleEsc);
      }, [onClose]);

      // Reset template fields when switching type
      useEffect(() => { setSubject(''); setDescription(''); }, [feedbackType]);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setSending(true);
        try {
          await db.collection('feedback').add({
            type: feedbackType,
            subject,
            description,
            timestamp: Date.now(),
            userAgent: navigator.userAgent,
          });
          setSent(true);
        } catch {
          alert('Failed to send feedback. Please try again.');
        } finally {
          setSending(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4"
             onClick={onClose}>
          <div className="bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-lg shadow-2xl"
               onClick={e => e.stopPropagation()}>
            <div className="bg-zinc-800 border-b border-zinc-700 p-3 flex items-center justify-between rounded-t-xl">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:bg-red-400" onClick={onClose}></div>
                  <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div className="flex items-center gap-2">
                  <Icon name="MessageSquare" size={16} className="text-amber-500" />
                  <span className="font-mono text-zinc-200 text-sm font-bold">Send Feedback</span>
                </div>
              </div>
              <button onClick={onClose} className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded">
                <Icon name="X" size={18} />
              </button>
            </div>

            {sent ? (
              <div className="p-8 text-center">
                <div className="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4">
                  <Icon name="Check" size={24} className="text-green-400" />
                </div>
                <p className="font-mono text-zinc-200 font-bold mb-1">Thanks for your feedback!</p>
                <p className="text-zinc-500 text-sm">Your message has been sent.</p>
                <button onClick={onClose}
                        className="mt-4 px-6 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-mono text-sm rounded-lg transition-colors">
                  Close
                </button>
              </div>
            ) : (
              <form onSubmit={handleSubmit} className="p-6">
                {/* Type toggle */}
                <div className="flex bg-zinc-800 rounded-lg p-0.5 mb-5">
                  {Object.entries(templates).map(([key, val]) => (
                    <button key={key} type="button" onClick={() => setFeedbackType(key)}
                            className={`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-md font-mono text-xs transition-all
                                      ${feedbackType === key ? 'bg-amber-500 text-zinc-900 font-bold' : 'text-zinc-400 hover:text-zinc-200'}`}>
                      <Icon name={val.icon} size={14} />
                      {val.label}
                    </button>
                  ))}
                </div>

                {/* Subject */}
                <label className="block font-mono text-xs text-zinc-500 mb-1.5">
                  <span className="text-green-400">$</span> subject
                </label>
                <input type="text" value={subject} onChange={e => setSubject(e.target.value)}
                       required autoFocus placeholder={t.subjectPlaceholder}
                       className="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 font-mono text-sm
                                placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none mb-4" />

                {/* Description */}
                <label className="block font-mono text-xs text-zinc-500 mb-1.5">
                  <span className="text-green-400">$</span> description
                </label>
                <textarea value={description} onChange={e => setDescription(e.target.value)}
                          required placeholder={t.descriptionPlaceholder} rows={8}
                          className="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 font-mono text-sm
                                   placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none mb-4 resize-none" />

                <button type="submit" disabled={sending}
                        className="w-full bg-amber-500 hover:bg-amber-400 disabled:opacity-50 disabled:cursor-not-allowed
                                 text-zinc-900 font-mono font-bold text-sm py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2">
                  {sending ? (
                    <><div className="animate-spin rounded-full h-4 w-4 border-t-2 border-zinc-900"></div> Sending...</>
                  ) : (
                    <><Icon name="Send" size={14} /> Send Feedback</>
                  )}
                </button>
              </form>
            )}
          </div>
        </div>
      );
    };

    // Preferences Modal
    const PreferencesModal = ({ hiddenTabs, onToggle, onClose }) => {
      useEffect(() => {
        const handleEsc = (e) => e.key === 'Escape' && onClose();
        window.addEventListener('keydown', handleEsc);
        return () => window.removeEventListener('keydown', handleEsc);
      }, [onClose]);

      const coreTabs = [
        { id: 'projects', icon: 'FolderGit2', name: 'Original Projects', locked: true },
        { id: 'forked-projects', icon: 'GitFork', name: 'Forked Projects' },
        { id: 'starred', icon: 'Star', name: 'Starred' },
      ];

      // Group apps by discipline
      const grouped = {};
      CONFIG.INTEGRATED_APPS.forEach(app => {
        const d = app.discipline || 'other';
        if (!grouped[d]) grouped[d] = [];
        grouped[d].push(app);
      });

      const renderToggle = (tab) => {
        const isHidden = hiddenTabs.includes(tab.id);
        const isLocked = tab.locked;
        return (
          <button key={tab.id} disabled={isLocked}
                  onClick={() => !isLocked && onToggle(tab.id)}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg font-mono text-sm transition-colors ${
                    isLocked ? 'text-zinc-500 cursor-default' :
                    isHidden ? 'text-zinc-600 hover:bg-zinc-800' :
                    'text-zinc-200 bg-zinc-800 hover:bg-zinc-750'
                  }`}>
            <Icon name={tab.icon} size={16} className={isHidden ? 'text-zinc-700' : 'text-amber-500'} />
            <span className="flex-1 text-left truncate">{tab.name}</span>
            {isLocked ? (
              <Icon name="Lock" size={14} className="text-zinc-700" />
            ) : (
              <div className={`w-8 h-5 rounded-full relative transition-colors ${
                isHidden ? 'bg-zinc-700' : 'bg-amber-500'
              }`}>
                <div className={`absolute top-0.5 w-4 h-4 rounded-full bg-white shadow transition-all ${
                  isHidden ? 'left-0.5' : 'left-3.5'
                }`}></div>
              </div>
            )}
          </button>
        );
      };

      return (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4"
             onClick={onClose}>
          <div className="bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-md shadow-2xl max-h-[80vh] flex flex-col"
               onClick={e => e.stopPropagation()}>
            <div className="bg-zinc-800 border-b border-zinc-700 p-3 flex items-center justify-between rounded-t-xl shrink-0">
              <div className="flex items-center gap-3">
                <div className="flex gap-1.5">
                  <div className="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:bg-red-400" onClick={onClose}></div>
                  <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div className="flex items-center gap-2">
                  <Icon name="Settings" size={16} className="text-amber-500" />
                  <span className="font-mono text-zinc-200 text-sm font-bold">Preferences</span>
                </div>
              </div>
              <button onClick={onClose} className="text-zinc-500 hover:text-zinc-300 p-1 hover:bg-zinc-700 rounded">
                <Icon name="X" size={18} />
              </button>
            </div>
            <div className="p-4 overflow-y-auto">
              <label className="block font-mono text-xs text-zinc-500 mb-3">
                <span className="text-green-400">$</span> visible tabs
              </label>

              <div className="mb-4">
                <div className="flex items-center gap-2 px-1 mb-2">
                  <Icon name="Github" size={14} className="text-zinc-500" />
                  <span className="font-mono text-[10px] uppercase tracking-widest text-zinc-500">GitHub</span>
                  <div className="flex-1 h-px bg-zinc-800"></div>
                </div>
                <div className="space-y-1">
                  {coreTabs.map(renderToggle)}
                </div>
              </div>

              {CONFIG.DISCIPLINES.filter(d => grouped[d.id]?.length > 0).map(disc => (
                <div key={disc.id} className="mb-4">
                  <div className="flex items-center gap-2 px-1 mb-2">
                    <Icon name={disc.icon} size={14} className="text-zinc-500" />
                    <span className="font-mono text-[10px] uppercase tracking-widest text-zinc-500">{disc.name}</span>
                    <div className="flex-1 h-px bg-zinc-800"></div>
                  </div>
                  <div className="space-y-1">
                    {grouped[disc.id].map(app => renderToggle({ id: app.id, icon: app.icon, name: app.name }))}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // Embedded App View - iframe for local apps
    const EmbeddedApp = ({ app, isAdmin, authUser }) => {
      const isFullscreen = app.fullscreen;
      const iframeRef = React.useRef(null);
      const [altIndex, setAltIndex] = useState(0);

      const hasAlts = app.alternatives && app.alternatives.length > 1;
      const currentAlt = hasAlts ? app.alternatives[altIndex] : null;
      const currentUrl = currentAlt ? currentAlt.url : app.url;
      const currentName = currentAlt ? currentAlt.name : app.name;
      const currentIcon = currentAlt ? currentAlt.icon : app.icon;

      // Broadcast auth state to iframe on mount and when auth changes
      React.useEffect(() => {
        const iframe = iframeRef.current;
        if (!iframe) return;
        const sendAuth = async () => {
          try {
            // Get fresh ID token for SSO users
            let idToken = null;
            const currentUser = auth.currentUser;
            if (currentUser) {
              try { idToken = await currentUser.getIdToken(); } catch {}
            }
            iframe.contentWindow.postMessage({
              type: 'admin-auth',
              isAdmin: !!isAdmin,
              key: isAdmin ? CONFIG.ADMIN_PASSWORD : null,
              // SSO fields for child PWAs
              sso: authUser ? {
                uid: authUser.uid,
                email: authUser.email,
                displayName: authUser.displayName,
                photoURL: authUser.photoURL,
                idToken,
              } : null,
            }, '*');
          } catch(e) {}
        };
        // Send on load and on auth change
        iframe.addEventListener('load', sendAuth);
        sendAuth();
        return () => iframe.removeEventListener('load', sendAuth);
      }, [isAdmin, authUser]);

      const hasHeader = !isFullscreen || hasAlts;
      const headerHeight = hasHeader ? 44 : 0;

      return (
        <div className={`relative w-full bg-zinc-900 overflow-hidden shadow-2xl ${
          isFullscreen
            ? 'h-[calc(100vh-64px)] border-t border-zinc-700'
            : 'h-[calc(100vh-160px)] min-h-[600px] rounded-xl border border-zinc-700'
        }`}>
          {/* App header bar */}
          {hasHeader && (
            <div className="bg-zinc-800 border-b border-zinc-700 px-4 py-2 flex items-center justify-between">
              <div className="flex items-center gap-3">
                {!isFullscreen && (
                  <div className="flex gap-1.5">
                    <div className="w-2.5 h-2.5 rounded-full bg-red-500/80"></div>
                    <div className="w-2.5 h-2.5 rounded-full bg-yellow-500/80"></div>
                    <div className="w-2.5 h-2.5 rounded-full bg-green-500/80"></div>
                  </div>
                )}
                <div className="flex items-center gap-2">
                  <Icon name={currentIcon} size={16} className="text-amber-500" />
                  <span className="font-mono text-zinc-300 text-sm font-medium">{currentName}</span>
                  {app.isLocal && (
                    <span className="text-xs bg-green-500/20 text-green-400 px-1.5 py-0.5 rounded font-mono">local</span>
                  )}
                </div>
              </div>
              <div className="flex items-center gap-2">
                {/* Alternatives toggle */}
                {hasAlts && (
                  <div className="flex bg-zinc-700/50 rounded-lg p-0.5">
                    {app.alternatives.map((alt, i) => (
                      <button key={alt.url} onClick={() => setAltIndex(i)}
                              className={`flex items-center gap-1.5 px-2.5 py-1 rounded-md font-mono text-xs transition-all
                                        ${altIndex === i
                                          ? 'bg-amber-500 text-zinc-900'
                                          : 'text-zinc-400 hover:text-zinc-200'}`}>
                        <Icon name={alt.icon || app.icon} size={12} />
                        <span className="hidden sm:inline">{alt.name}</span>
                      </button>
                    ))}
                  </div>
                )}
                <a href={currentUrl} target="_blank" rel="noopener noreferrer"
                   className="flex items-center gap-1.5 bg-zinc-700 hover:bg-zinc-600 text-zinc-300 text-xs font-mono px-3 py-1.5 rounded-lg transition-colors">
                  <Icon name="ExternalLink" size={12} />
                  <span className="hidden sm:inline">Open in new tab</span>
                </a>
              </div>
            </div>
          )}
          {/* iframe */}
          <iframe ref={iframeRef} src={currentUrl}
                  className={`w-full border-0 ${hasHeader ? 'h-[calc(100%-44px)]' : 'h-full'}`}
                  title={currentName}
                  allow="camera; microphone; clipboard-read; clipboard-write" />
        </div>
      );
    };

    // Main App
    function App() {
      const [repos, setRepos] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedLanguage, setSelectedLanguage] = useState('all');
      const [sortBy, setSortBy] = useState('updated');
      const [selectedRepo, setSelectedRepo] = useState(null);
      const [username, setUsername] = useState(CONFIG.GITHUB_USERNAME);
      const [activeView, setActiveView] = useState('projects'); // 'projects', 'forked-projects', 'starred', or app id
      const [starredRepos, setStarredRepos] = useState([]);
      const [loadingStarred, setLoadingStarred] = useState(false);
      const [forkFilter, setForkFilter] = useState('all'); // 'all', 'contributed', 'not-contributed'
      const [forkContributions, setForkContributions] = useState({}); // { repoFullName: boolean }
      const [loadingContributions, setLoadingContributions] = useState(false);
      const [isAdmin, setIsAdmin] = useState(false);
      const [authUser, setAuthUser] = useState(null); // Firebase SSO user object
      const [showLoginModal, setShowLoginModal] = useState(false);
      const [hiddenRepos, setHiddenRepos] = useState(() => {
        try { return JSON.parse(localStorage.getItem('hiddenRepos') || '[]'); }
        catch { return []; }
      });

      const [showPreferences, setShowPreferences] = useState(false);
      const [showReleaseNotes, setShowReleaseNotes] = useState(false);
      const [showFeedback, setShowFeedback] = useState(false);
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

      // Close mobile menu on resize past sm breakpoint
      useEffect(() => {
        const handleResize = () => { if (window.innerWidth >= 640) setMobileMenuOpen(false); };
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      // Dismiss splash screen after app mounts
      useEffect(() => {
        const timer = setTimeout(() => {
          const splash = document.getElementById('splash');
          if (splash) {
            splash.classList.add('fade-out');
            setTimeout(() => splash.remove(), 700);
          }
        }, 2000);
        return () => clearTimeout(timer);
      }, []);

      // Firebase Auth state listener — restore session on reload
      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged((user) => {
          if (user) {
            setAuthUser({
              uid: user.uid,
              email: user.email,
              displayName: user.displayName,
              photoURL: user.photoURL,
            });
            const isEmailAdmin = CONFIG.ADMIN_EMAILS.length > 0
              ? CONFIG.ADMIN_EMAILS.includes(user.email)
              : true;
            setIsAdmin(isEmailAdmin);
          } else {
            // Only clear SSO state; password admin is handled separately
            if (authUser) {
              setAuthUser(null);
              setIsAdmin(false);
            }
          }
        });
        return () => unsubscribe();
      }, []);

      const handleLogin = (result) => {
        if (result.method === 'sso') {
          setAuthUser(result.user);
          setIsAdmin(result.isAdmin);
        } else {
          // Password-based login
          setIsAdmin(true);
        }
        setShowLoginModal(false);
      };

      const handleLogout = async () => {
        if (authUser) {
          try { await auth.signOut(); } catch {}
        }
        setAuthUser(null);
        setIsAdmin(false);
      };
      const [hiddenTabs, setHiddenTabs] = useState(() => {
        try { return JSON.parse(localStorage.getItem('hiddenTabs') || '[]'); }
        catch { return []; }
      });

      const toggleTabVisibility = (tabId) => {
        setHiddenTabs(prev => {
          const next = prev.includes(tabId) ? prev.filter(id => id !== tabId) : [...prev, tabId];
          localStorage.setItem('hiddenTabs', JSON.stringify(next));
          return next;
        });
      };

      const visibleApps = CONFIG.INTEGRATED_APPS.filter(app =>
        (!app.requiresAdmin || isAdmin) && !hiddenTabs.includes(app.id)
      );

      // If the active view is now hidden, fall back to projects
      useEffect(() => {
        if (activeView === 'projects') return;
        if ((activeView === 'forked-projects' || activeView === 'starred') && hiddenTabs.includes(activeView)) {
          setActiveView('projects');
        } else if (activeView !== 'forked-projects' && activeView !== 'starred') {
          const app = CONFIG.INTEGRATED_APPS.find(a => a.id === activeView);
          if (app && hiddenTabs.includes(app.id)) setActiveView('projects');
        }
      }, [hiddenTabs, activeView]);

      const toggleHideRepo = (repoName) => {
        setHiddenRepos(prev => {
          const next = prev.includes(repoName) ? prev.filter(n => n !== repoName) : [...prev, repoName];
          localStorage.setItem('hiddenRepos', JSON.stringify(next));
          return next;
        });
      };

      // Cached GitHub fetch helper — Firestore first, localStorage fallback
      const cachedFetch = async (url, cacheKey) => {
        const CACHE_TTL = 5 * 60 * 1000;
        const docId = cacheKey.replace(/[\/\.]/g, '_');

        // 1. Check localStorage (instant)
        try {
          const local = JSON.parse(localStorage.getItem(cacheKey));
          if (local && Date.now() - local.ts < CACHE_TTL) return local.data;
        } catch {}

        // 2. Check Firestore
        try {
          const doc = await db.collection('github_cache').doc(docId).get();
          if (doc.exists) {
            const { ts, data } = doc.data();
            if (Date.now() - ts < CACHE_TTL) {
              try { localStorage.setItem(cacheKey, JSON.stringify({ ts, data })); } catch {}
              return data;
            }
          }
        } catch {}

        // 3. Fetch from GitHub API
        const response = await fetch(url);
        if (!response.ok) {
          if (response.status === 403) throw new Error('GitHub API rate limit exceeded. Try again in a few minutes.');
          if (response.status === 404) throw new Error('User not found');
          throw new Error('Failed to fetch repositories');
        }
        const data = await response.json();

        // 4. Write to both caches
        const ts = Date.now();
        try { localStorage.setItem(cacheKey, JSON.stringify({ ts, data })); } catch {}
        try { await db.collection('github_cache').doc(docId).set({ ts, data }); } catch {}
        return data;
      };

      // Fetch repos
      useEffect(() => {
        if (username === 'YOUR_GITHUB_USERNAME') {
          setLoading(false);
          return;
        }

        const fetchRepos = async () => {
          setLoading(true);
          setError(null);
          try {
            let data = await cachedFetch(
              `https://api.github.com/users/${username}/repos?per_page=${CONFIG.MAX_REPOS}&sort=updated`,
              `gh_repos_${username}`
            );

            // Apply filters
            if (CONFIG.HIDE_FORKS) data = data.filter(r => !r.fork);
            if (CONFIG.EXCLUDE_REPOS.length) {
              data = data.filter(r => !CONFIG.EXCLUDE_REPOS.includes(r.name));
            }
            if (CONFIG.FILTER_TOPICS.length) {
              data = data.filter(r =>
                r.topics && r.topics.some(t => CONFIG.FILTER_TOPICS.includes(t))
              );
            }

            setRepos(data);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };
        fetchRepos();
      }, [username]);

      // Fetch contribution status for forked repos
      useEffect(() => {
        if (activeView !== 'forked-projects') return;
        const forkedRepos = repos.filter(r => r.fork);
        const unchecked = forkedRepos.filter(r => !(r.full_name in forkContributions));
        if (unchecked.length === 0) return;

        setLoadingContributions(true);
        const checkContributions = async () => {
          const results = { ...forkContributions };
          await Promise.all(unchecked.map(async (repo) => {
            try {
              const res = await fetch(
                `https://api.github.com/repos/${repo.full_name}/commits?author=${username}&per_page=1`
              );
              if (res.ok) {
                const commits = await res.json();
                results[repo.full_name] = commits.length > 0;
              } else {
                results[repo.full_name] = false;
              }
            } catch {
              results[repo.full_name] = false;
            }
          }));
          setForkContributions(results);
          setLoadingContributions(false);
        };
        checkContributions();
      }, [activeView, repos, username]);

      // Fetch starred repos
      useEffect(() => {
        if (activeView !== 'starred' || starredRepos.length > 0) return;
        setLoadingStarred(true);
        const fetchStarred = async () => {
          try {
            const data = await cachedFetch(
              `https://api.github.com/users/${username}/starred?per_page=${CONFIG.MAX_REPOS}&sort=updated`,
              `gh_starred_${username}`
            );
            setStarredRepos(data);
          } catch { /* ignore */ }
          finally { setLoadingStarred(false); }
        };
        fetchStarred();
      }, [activeView, username]);

      // Get languages
      const languages = useMemo(() => {
        const source = activeView === 'starred' ? starredRepos : repos;
        const langs = [...new Set(source.map(r => r.language).filter(Boolean))];
        return ['all', ...langs.sort()];
      }, [repos, starredRepos, activeView]);

      // Filter and sort
      const filteredRepos = useMemo(() => {
        let filtered = activeView === 'starred' ? starredRepos : repos;

        // Hide hidden repos for non-admin users
        if (!isAdmin && activeView !== 'starred') {
          filtered = filtered.filter(r => !hiddenRepos.includes(r.name));
        }

        if (searchTerm) {
          const term = searchTerm.toLowerCase();
          filtered = filtered.filter(r =>
            r.name.toLowerCase().includes(term) ||
            (r.description && r.description.toLowerCase().includes(term)) ||
            (r.topics && r.topics.some(t => t.toLowerCase().includes(term)))
          );
        }

        if (selectedLanguage !== 'all') {
          filtered = filtered.filter(r => r.language === selectedLanguage);
        }

        if (activeView === 'forked-projects') {
          filtered = filtered.filter(r => r.fork);
          // Apply contribution filter
          if (forkFilter === 'contributed') {
            filtered = filtered.filter(r => forkContributions[r.full_name] === true);
          } else if (forkFilter === 'not-contributed') {
            filtered = filtered.filter(r => forkContributions[r.full_name] === false);
          }
        } else if (activeView !== 'starred') {
          filtered = filtered.filter(r => !r.fork);
        }

        return filtered.sort((a, b) => {
          switch (sortBy) {
            case 'stars': return b.stargazers_count - a.stargazers_count;
            case 'name': return a.name.localeCompare(b.name);
            default: return new Date(b.updated_at) - new Date(a.updated_at);
          }
        });
      }, [repos, starredRepos, searchTerm, selectedLanguage, activeView, sortBy, isAdmin, hiddenRepos, forkFilter, forkContributions]);

      return (
        <div className="min-h-screen bg-zinc-950 text-zinc-100">
          {/* Grid background */}
          <div className="fixed inset-0 opacity-5 pointer-events-none"
               style={{ backgroundImage: 'linear-gradient(rgba(251,191,36,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(251,191,36,0.3) 1px, transparent 1px)',
                        backgroundSize: '50px 50px' }}></div>

          {/* Header */}
          <header className="relative border-b border-zinc-800 bg-zinc-900/80 backdrop-blur-sm sticky top-0 z-40">
            <div className="max-w-7xl mx-auto px-4 py-3">
              <div className="flex items-center gap-4">
                <div className="shrink-0">
                  <img src="zwartbol-icon.svg" alt={CONFIG.SITE_TITLE} className="w-9 h-9 sm:hidden" />
                  <img src="zwartbol-logo.svg" alt={CONFIG.SITE_TITLE} className="hidden sm:block h-8" />
                </div>

                {/* Mobile hamburger */}
                <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                        className="sm:hidden flex items-center justify-center w-9 h-9 rounded-lg bg-zinc-800/60 text-zinc-400
                                 hover:bg-zinc-700 hover:text-zinc-200 transition-colors"
                        title="Menu">
                  <Icon name={mobileMenuOpen ? 'X' : 'Menu'} size={18} />
                </button>
                <div className="flex-1 sm:hidden"></div>

                {/* Navigation - GitHub dropdown + discipline dropdowns */}
                <div className="hidden sm:flex items-center gap-1.5 flex-1 justify-center min-w-0">
                  {(isAdmin || authUser) && (() => {
                    const repoViews = [
                      { id: 'projects', icon: 'FolderGit2', name: 'Original Projects' },
                      ...(!hiddenTabs.includes('forked-projects') ? [{ id: 'forked-projects', icon: 'GitFork', name: 'Forked Projects' }] : []),
                      ...(!hiddenTabs.includes('starred') ? [{ id: 'starred', icon: 'Star', name: 'Starred' }] : []),
                    ];
                    const isRepoActive = repoViews.some(v => v.id === activeView);
                    const [repoOpen, setRepoOpen] = React.useState(false);
                    const repoRef = React.useRef(null);

                    React.useEffect(() => {
                      if (!repoOpen) return;
                      const handleClick = (e) => {
                        if (repoRef.current && !repoRef.current.contains(e.target)) setRepoOpen(false);
                      };
                      document.addEventListener('mousedown', handleClick);
                      return () => document.removeEventListener('mousedown', handleClick);
                    }, [repoOpen]);

                    return (
                      <div ref={repoRef} className="relative">
                        <button onClick={() => setRepoOpen(!repoOpen)}
                                className={`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg font-mono text-xs font-medium transition-all
                                          ${isRepoActive
                                            ? 'bg-amber-500 text-zinc-900 shadow-lg shadow-amber-500/20'
                                            : 'bg-zinc-800/60 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200'}`}>
                          <Icon name="Github" size={14} />
                          <span className="hidden md:inline">GitHub</span>
                          <Icon name="ChevronDown" size={10}
                                className={`transition-transform duration-200 ${repoOpen ? 'rotate-180' : ''}`} />
                        </button>
                        {repoOpen && (
                          <div className="absolute top-full left-0 mt-1.5 bg-zinc-900 border border-zinc-700 rounded-lg
                                          shadow-2xl shadow-black/50 z-50 min-w-[220px] py-1 overflow-hidden">
                            <div className="px-3 py-1.5 border-b border-zinc-800">
                              <span className="font-mono text-[10px] uppercase tracking-widest text-zinc-600">GitHub</span>
                            </div>
                            {repoViews.map(v => (
                              <button key={v.id}
                                      onClick={() => { setActiveView(v.id); setRepoOpen(false); }}
                                      className={`w-full flex items-center gap-2.5 px-3 py-2 text-left transition-colors
                                                ${activeView === v.id
                                                  ? 'bg-amber-500/15 text-amber-400'
                                                  : 'text-zinc-300 hover:bg-zinc-800 hover:text-zinc-100'}`}>
                                <Icon name={v.icon} size={16}
                                      className={activeView === v.id ? 'text-amber-500' : 'text-zinc-500'} />
                                <span className="font-mono text-xs">{v.name}</span>
                              </button>
                            ))}
                          </div>
                        )}
                      </div>
                    );
                  })()}
                  <DisciplineNav activeView={activeView} onSelectApp={setActiveView} visibleApps={visibleApps} />
                </div>

                <div className="flex items-center gap-2 shrink-0">
                  <a href={`https://github.com/${username}`} target="_blank" rel="noopener noreferrer"
                     title={`@${username}`}
                     className="flex items-center justify-center w-9 h-9 rounded-lg text-zinc-400 hover:text-amber-400 hover:bg-zinc-800 transition-colors">
                    <Icon name="Github" size={18} />
                  </a>
                  <button onClick={() => setShowFeedback(true)}
                          className="flex items-center justify-center w-9 h-9 rounded-lg bg-zinc-800/60 text-zinc-500
                                   hover:text-amber-400 hover:bg-zinc-700 transition-colors"
                          title="Send Feedback">
                    <Icon name="MessageSquare" size={16} />
                  </button>
                  {isAdmin || authUser ? (
                    <>
                      {authUser && authUser.photoURL && (
                        <img src={authUser.photoURL} alt="" referrerPolicy="no-referrer"
                             className="w-8 h-8 rounded-full border border-amber-500/50"
                             title={authUser.displayName || authUser.email} />
                      )}
                      <button onClick={() => setShowPreferences(true)}
                              className="flex items-center justify-center w-9 h-9 rounded-lg bg-zinc-800/60 text-zinc-400
                                       hover:text-amber-400 hover:bg-zinc-700 transition-colors"
                              title="Preferences">
                        <Icon name="Settings" size={16} />
                      </button>
                      <button onClick={handleLogout}
                              className="flex items-center justify-center w-9 h-9 rounded-lg bg-amber-500/20 text-amber-400
                                       hover:bg-amber-500/30 transition-colors border border-amber-500/30"
                              title="Sign out">
                        <Icon name="LogOut" size={16} />
                      </button>
                    </>
                  ) : (
                    <button onClick={() => setShowLoginModal(true)}
                            className="flex items-center justify-center w-9 h-9 rounded-lg bg-zinc-800/60 text-zinc-500
                                     hover:text-zinc-300 hover:bg-zinc-700 transition-colors"
                            title="Sign in">
                      <Icon name="Lock" size={16} />
                    </button>
                  )}
                </div>
              </div>
            </div>

            {/* Mobile navigation menu */}
            {mobileMenuOpen && (
              <div className="sm:hidden border-t border-zinc-800 bg-zinc-900/95 backdrop-blur-sm max-h-[70vh] overflow-y-auto">
                <div className="px-4 py-3 space-y-3">
                  {/* GitHub section — only for logged-in users */}
                  {(isAdmin || authUser) && (
                  <div>
                    <div className="font-mono text-[10px] uppercase tracking-widest text-zinc-600 mb-1.5 px-1">GitHub</div>
                    {[
                      { id: 'projects', icon: 'FolderGit2', name: 'Original Projects' },
                      ...(!hiddenTabs.includes('forked-projects') ? [{ id: 'forked-projects', icon: 'GitFork', name: 'Forked Projects' }] : []),
                      ...(!hiddenTabs.includes('starred') ? [{ id: 'starred', icon: 'Star', name: 'Starred' }] : []),
                    ].map(v => (
                      <button key={v.id}
                              onClick={() => { setActiveView(v.id); setMobileMenuOpen(false); }}
                              className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-lg text-left transition-colors
                                        ${activeView === v.id
                                          ? 'bg-amber-500/15 text-amber-400'
                                          : 'text-zinc-300 hover:bg-zinc-800 hover:text-zinc-100'}`}>
                        <Icon name={v.icon} size={16}
                              className={activeView === v.id ? 'text-amber-500' : 'text-zinc-500'} />
                        <span className="font-mono text-xs">{v.name}</span>
                      </button>
                    ))}
                  </div>
                  )}

                  {/* Discipline sections */}
                  {CONFIG.DISCIPLINES.map(disc => {
                    const discApps = visibleApps.filter(app => app.discipline === disc.id);
                    if (discApps.length === 0) return null;
                    return (
                      <div key={disc.id}>
                        <div className="font-mono text-[10px] uppercase tracking-widest text-zinc-600 mb-1.5 px-1 flex items-center gap-1.5">
                          <Icon name={disc.icon} size={12} />
                          {disc.name}
                        </div>
                        {discApps.map(app => (
                          <button key={app.id}
                                  onClick={() => { setActiveView(app.id); setMobileMenuOpen(false); }}
                                  className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-lg text-left transition-colors
                                            ${activeView === app.id
                                              ? 'bg-amber-500/15 text-amber-400'
                                              : 'text-zinc-300 hover:bg-zinc-800 hover:text-zinc-100'}`}>
                            <Icon name={app.icon} size={16}
                                  className={activeView === app.id ? 'text-amber-500' : 'text-zinc-500'} />
                            <span className="font-mono text-xs">{app.name}</span>
                          </button>
                        ))}
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </header>

          {/* Filters - show in projects, forked-projects, and starred views */}
          {(activeView === 'projects' || activeView === 'forked-projects' || activeView === 'starred') && !loading && !error && !loadingStarred && (
            <div className="border-b border-zinc-800 bg-zinc-900/50 backdrop-blur-sm sticky top-[61px] z-30">
              <div className="max-w-7xl mx-auto px-4 py-4">
                <div className="flex flex-col sm:flex-row gap-4">
                  <div className="relative flex-1">
                    <Icon name="Search" size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500" />
                    <input type="text" placeholder="Search projects..."
                           value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}
                           className="w-full bg-zinc-800 border border-zinc-700 rounded-lg pl-10 pr-4 py-2.5 font-mono text-sm
                                    placeholder:text-zinc-600 focus:border-amber-500 focus:outline-none" />
                  </div>
                  <div className="relative">
                    <select value={selectedLanguage} onChange={(e) => setSelectedLanguage(e.target.value)}
                            className="appearance-none bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 pr-10 font-mono text-sm
                                     focus:border-amber-500 focus:outline-none cursor-pointer min-w-[140px]">
                      {languages.map(lang => (
                        <option key={lang} value={lang}>{lang === 'all' ? 'All Languages' : lang}</option>
                      ))}
                    </select>
                    <Icon name="ChevronDown" size={16} className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none" />
                  </div>
                  {activeView === 'forked-projects' && (
                    <div className="relative">
                      <select value={forkFilter} onChange={(e) => setForkFilter(e.target.value)}
                              className="appearance-none bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 pr-10 font-mono text-sm
                                       focus:border-amber-500 focus:outline-none cursor-pointer min-w-[180px]"
                              disabled={loadingContributions}>
                        <option value="all">All Forks</option>
                        <option value="contributed">My Commits</option>
                        <option value="not-contributed">No Commits By Me</option>
                      </select>
                      <Icon name={loadingContributions ? "Loader" : "ChevronDown"} size={16}
                            className={`absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none${loadingContributions ? ' animate-spin' : ''}`} />
                    </div>
                  )}
                  <div className="relative">
                    <select value={sortBy} onChange={(e) => setSortBy(e.target.value)}
                            className="appearance-none bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2.5 pr-10 font-mono text-sm
                                     focus:border-amber-500 focus:outline-none cursor-pointer min-w-[160px]">
                      <option value="updated">Recently Updated</option>
                      <option value="stars">Most Stars</option>
                      <option value="name">Alphabetical</option>
                    </select>
                    <Icon name="ChevronDown" size={16} className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none" />
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Fullscreen App View - rendered outside main container */}
          {activeView !== 'projects' && activeView !== 'forked-projects' && activeView !== 'starred' && (() => {
            const app = CONFIG.INTEGRATED_APPS.find(a => a.id === activeView);
            if (app && app.requiresAdmin && !isAdmin) return null;
            return app && app.fullscreen ? <EmbeddedApp app={app} isAdmin={isAdmin} authUser={authUser} /> : null;
          })()}

          {/* Main */}
          <main className="max-w-7xl mx-auto px-4 py-6 relative">
            {/* Embedded App View (non-fullscreen) */}
            {activeView !== 'projects' && activeView !== 'forked-projects' && activeView !== 'starred' && (() => {
              const app = CONFIG.INTEGRATED_APPS.find(a => a.id === activeView);
              if (app && app.requiresAdmin && !isAdmin) return null;
              return app && !app.fullscreen ? <EmbeddedApp app={app} isAdmin={isAdmin} authUser={authUser} /> : null;
            })()}

            {/* Projects View */}
            {(activeView === 'projects' || activeView === 'forked-projects' || activeView === 'starred') && (
              <>
                {(activeView === 'starred' ? loadingStarred : loading) ? (
                  <div className="flex flex-col items-center justify-center py-20">
                    <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-amber-500 mb-4"></div>
                    <p className="font-mono text-zinc-400">{activeView === 'starred' ? 'Fetching starred repos...' : 'Fetching projects from GitHub...'}</p>
                  </div>
                ) : error ? (
                  <div className="text-center py-20">
                    <div className="bg-red-500/10 border border-red-500/30 rounded-lg p-6 max-w-md mx-auto">
                      <Icon name="AlertCircle" size={32} className="mx-auto mb-3 text-red-400" />
                      <p className="text-red-400 font-mono">{error}</p>
                      <p className="text-zinc-500 text-sm mt-2">Check the username and try again.</p>
                    </div>
                  </div>
                ) : (
                  <>
                    <div className="mb-6 font-mono text-sm text-zinc-500">
                      <span className="text-green-400">→</span> Found <span className="text-amber-400">{filteredRepos.length}</span> {activeView === 'starred' ? 'starred repos' : 'projects'}
                      {searchTerm && <span> matching "{searchTerm}"</span>}
                    </div>

                    {filteredRepos.length > 0 ? (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredRepos.map(repo => (
                          <ProjectCard key={repo.id} repo={repo}
                                       onClick={() => activeView === 'starred' ? window.open(repo.html_url, '_blank') : setSelectedRepo(repo)}
                                       isAdmin={isAdmin} isHidden={hiddenRepos.includes(repo.name)}
                                       onToggleHide={toggleHideRepo} />
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-20">
                        <Icon name="Package" size={48} className="mx-auto mb-4 text-zinc-600" />
                        <p className="font-mono text-zinc-500">No projects match your filters</p>
                      </div>
                    )}
                  </>
                )}
              </>
            )}
          </main>

          {/* Footer */}
          <footer className="border-t border-zinc-800 bg-zinc-900/50 py-8 mt-12">
            <div className="max-w-7xl mx-auto px-4 text-center space-y-2">
              <p className="font-mono text-sm text-zinc-600">
                <span className="text-amber-500/50">/*</span> Built with React • Powered by GitHub API <span className="text-amber-500/50">*/</span>
              </p>
              <div className="flex items-center justify-center gap-3 font-mono text-xs text-zinc-700">
                {BUILD_COMMIT !== 'dev' && (
                  <>
                    <a href={`https://github.com/${username}/pages/commit/${BUILD_COMMIT}`}
                       target="_blank" rel="noopener noreferrer"
                       className="flex items-center gap-1 hover:text-zinc-500 transition-colors">
                      <Icon name="GitCommitHorizontal" size={12} />
                      <span>{BUILD_COMMIT.slice(0, 7)}</span>
                    </a>
                    <span className="text-zinc-800">•</span>
                  </>
                )}
                <span className="flex items-center gap-1">
                  <Icon name="Calendar" size={12} />
                  <span>{BUILD_DATE !== 'dev' ? BUILD_DATE : 'development'}</span>
                </span>
                <span className="text-zinc-800">•</span>
                <button onClick={() => setShowReleaseNotes(!showReleaseNotes)}
                        className="flex items-center gap-1 hover:text-zinc-500 transition-colors cursor-pointer bg-transparent border-none p-0 font-mono text-xs text-zinc-700">
                  <Icon name="ScrollText" size={12} />
                  <span>Release Notes</span>
                  <Icon name={showReleaseNotes ? 'ChevronUp' : 'ChevronDown'} size={10} />
                </button>
              </div>

              {/* Expandable Release Notes */}
              {showReleaseNotes && (
                <div className="mt-4 max-w-2xl mx-auto text-left">
                  <div className="bg-zinc-900 border border-zinc-800 rounded-lg overflow-hidden">
                    <div className="px-4 py-3 border-b border-zinc-800 flex items-center justify-between">
                      <h3 className="font-mono text-sm text-zinc-300 flex items-center gap-2">
                        <Icon name="ScrollText" size={14} className="text-amber-500" />
                        Version History
                      </h3>
                      <a href={`https://github.com/${username}/pages/blob/main/RELEASES.md`}
                         target="_blank" rel="noopener noreferrer"
                         className="font-mono text-xs text-amber-500 hover:text-amber-400 transition-colors flex items-center gap-1">
                        Full changelog
                        <Icon name="ExternalLink" size={10} />
                      </a>
                    </div>
                    <div className="max-h-64 overflow-y-auto">
                      {(() => {
                        const grouped = {};
                        VERSION_HISTORY.forEach(v => {
                          if (!grouped[v.date]) grouped[v.date] = [];
                          grouped[v.date].push(v);
                        });
                        return Object.entries(grouped).map(([date, entries]) => (
                          <div key={date}>
                            <div className="px-4 py-2 bg-zinc-800/50 font-mono text-xs text-zinc-400 sticky top-0">
                              {date}
                            </div>
                            {entries.map((v, i) => (
                              <div key={v.hash} className="px-4 py-2 border-b border-zinc-800/50 hover:bg-zinc-800/30 transition-colors">
                                <div className="flex items-start gap-2">
                                  <a href={`https://github.com/${username}/pages/commit/${v.hash}`}
                                     target="_blank" rel="noopener noreferrer"
                                     className="font-mono text-xs text-amber-600 hover:text-amber-500 transition-colors shrink-0 mt-0.5">
                                    {v.hash}
                                  </a>
                                  <span className="font-mono text-xs text-zinc-400">{v.changes}</span>
                                </div>
                              </div>
                            ))}
                          </div>
                        ));
                      })()}
                    </div>
                  </div>
                </div>
              )}
            </div>
          </footer>

          {/* Login Modal */}
          {showLoginModal && (
            <LoginModal onLogin={handleLogin}
                        onClose={() => setShowLoginModal(false)} />
          )}

          {/* Feedback Modal */}
          {showFeedback && (
            <FeedbackModal onClose={() => setShowFeedback(false)} />
          )}

          {/* Preferences Modal */}
          {showPreferences && (
            <PreferencesModal hiddenTabs={hiddenTabs} onToggle={toggleTabVisibility}
                              onClose={() => setShowPreferences(false)} />
          )}

          {/* Documentation Reader Modal */}
          {selectedRepo && (
            <ProjectModal key={selectedRepo.id} repo={selectedRepo} username={username}
                          onClose={() => setSelectedRepo(null)} />
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
